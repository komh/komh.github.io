<HTML>
<HEAD>
<TITLE>DosQFileInfo</TITLE>
</HEAD>
<BODY>
<H1>DosQFileInfo</H1><!-- entering slot 137 -->Bindings:  <A HREF="286_L2H_DosQFileInfo.html">C</A>,
<A HREF="461_L2H_DosQFileInfo.html">MASM</A>
<BR>

<P>
This call returns information for a specific file.<!-- lm: 0x2 1 -->
<UL>
<P>
DosQFileInfo<!-- lm: 0x2 18 -->
<UL> (FileHandle, FileInfoLevel, FileInfoBuf,
FileInfoBufSize)<!-- lm: 0x2 1 -->
</UL><!-- lm: 0x2 1 -->
<P>
<B>FileHandle</B> (HFILE) - input<!-- lm: 0x11 4 -->
<UL> File handle.<!-- lm: 0x2 1 -->
</UL><B> FileInfoLevel
</B>(USHORT) -  input<!-- lm: 0x11 4 -->
<UL> Level of file information
required. A value of 1, 2, or 3 can be specified. Level 4 is reserved. The
structures described in FileInfoBuf indicate the information returned for
each of these levels.<!-- lm: 0x2 1 -->
</UL><B> FileInfoBuf</B> (PBYTE)
-  output<!-- lm: 0x11 4 -->
<UL> Address of the storage area where the
system returns the requested level of file information. File information,
where applicable, is at least as accurate as the most recent <A HREF="012_L2_DosClose.html">DosClose</A>,
<A HREF="005_L2_DosBufReset.html">DosBufReset</A>,  <A HREF="144_L2_DosSetFileInfo.html">DosSetFileInfo</A>,
or <A HREF="150_L2_DosSetPathInfo.html">DosSetPathInfo</A>.<!-- lm: 0x2 4 -->
<P>
<B>Level 1 Information</B><!-- lm: 0x11 7 -->
<UL> FileInfoBuf contains
the following structure, to which file information is returned:<!-- lm: 0x2 7 -->
<P>
<B>filedate</B> (FDATE)<!-- lm: 0x11 10 -->
<UL> Structure containing the
date of file creation.<!-- lm: 0x2 10 -->
<P>
Bit<!-- lm: 0x2 20 -->
<UL> Description<!-- lm: 0x2 10 -->
</UL>15-9<!-- lm: 0x2 20 -->
<UL> Year, in binary, of file creation<!-- lm: 0x2 10 -->
</UL>8-5<!-- lm: 0x2 20 -->
<UL> Month, in binary, of file creation<!-- lm: 0x2 10 -->
</UL>4-0<!-- lm: 0x2 20 -->
<UL> Day, in binary, of file creation.<!-- lm: 0x2 7 -->
</UL><B> filetime
</B>(FTIME)<!-- lm: 0x11 10 -->
<UL> Structure containing the time of file
creation.<!-- lm: 0x2 10 -->
<P>
Bit<!-- lm: 0x2 20 -->
<UL> Description<!-- lm: 0x2 10 -->
</UL>15-11<!-- lm: 0x2 20 -->
<UL> Hours, in binary, of file creation<!-- lm: 0x2 10 -->
</UL>10-5<!-- lm: 0x2 20 -->
<UL> Minutes, in binary, of file creation<!-- lm: 0x2 10 -->
</UL>4-0<!-- lm: 0x2 20 -->
<UL> Seconds, in binary number of two-second
increments, of file creation.<!-- lm: 0x2 7 -->
</UL><B> fileaccessdate
</B>(FDATE)<!-- lm: 0x11 10 -->
<UL> Structure containing the date of last
access. See FDATE in filedate.<!-- lm: 0x2 7 -->
</UL><B> fileaccesstime
</B>(FTIME)<!-- lm: 0x11 10 -->
<UL> Structure containing the time of last
access. See FTIME in filetime.<!-- lm: 0x2 7 -->
</UL><B> writeaccessdate
</B>(FDATE)<!-- lm: 0x11 10 -->
<UL> Structure containing the date of last
write. See FDATE in filedate.<!-- lm: 0x2 7 -->
</UL><B> writeaccesstime
</B>(FTIME)<!-- lm: 0x11 10 -->
<UL> Structure containing the time of last
write. See FTIME in filetime.<!-- lm: 0x2 7 -->
</UL><B> filesize</B> (ULONG)
<!-- lm: 0x11 10 -->
<UL>File size.<!-- lm: 0x2 7 -->
</UL><B> filealloc
</B>(ULONG)<!-- lm: 0x11 10 -->
<UL> Allocated file size.<!-- lm: 0x2 7 -->
</UL><B> fileattrib
</B>(USHORT)<!-- lm: 0x11 10 -->
<UL> Attributes of the file, defined in
<A HREF="145_L2_DosSetFileMode.html">DosSetFileMode</A>.<!-- lm: 0x2 4 -->
</UL><B> Level
2 Information</B><!-- lm: 0x11 7 -->
<UL> FileInfoBuf contains a structure
similar to the Level 1 structure, with the addition of the cbList field
after the fileattrib field.<!-- lm: 0x2 7 -->
<P>
<B>cbList</B> (ULONG)<!-- lm: 0x11 10 -->
<UL> On output, this field contains
the length of the entire EA set for the file object.  This value can be
used to calculate the size of the buffer required to hold EA information
returned when FileInfoLevel = 3 is specified.<!-- lm: 0x2 4 -->
</UL><B> Level
3 Information</B><!-- lm: 0x11 7 -->
<UL> FileInfoBuf contains an EAOP structure,
which has the following format:<!-- lm: 0x2 7 -->
<P>
<B>fpGEAList</B> (PGEALIST)<!-- lm: 0x11 10 -->
<UL> Address of GEAList.
GEAList is a packed array of variable length "get EA" structures, each containing
an EA name and the length of the name.<!-- lm: 0x2 7 -->
</UL><B> fpFEAList
</B>(PFEALIST)<!-- lm: 0x11 10 -->
<UL> Address of FEAList. FEAList is a
packed array of variable length "full EA" structures, each containing an
EA name and its corresponding value, as well as the lengths of the name
and the value.<!-- lm: 0x2 7 -->
</UL><B> oError</B> (ULONG)<!-- lm: 0x11 10 -->
<UL> Offset
into structure where error has occurred.
<P>
On input, FileInfoBuf is an EAOP structure.  fpGEAList points to a GEA list
defining the attribute names whose values are returned.  fpFEAList points
to a data area where the relevant FEA list is returned.  The length field
of this FEA list is valid, giving the size of the FEA list buffer. oError
points to the offending GEA entry in case of error. Following is the format
of the GEAList structure:<!-- lm: 0x2 7 -->
</UL><B> cbList</B> (ULONG)
<!-- lm: 0x11 10 -->
<UL>Length of the GEA list, including the length itself.
<!-- lm: 0x2 7 -->
</UL><B>list</B> (GEA)<!-- lm: 0x11 10 -->
<UL> List
of GEA structures.  A GEA structure has the following format:<!-- lm: 0x2 10 -->
<P>
<B>cbName</B> (BYTE)<!-- lm: 0x11 13 -->
<UL> Length of EA ASCIIZ name,
which does not include the null character.<!-- lm: 0x2 10 -->
</UL><B> szName
</B>(CHAR)<!-- lm: 0x11 13 -->
<UL> ASCIIZ name of EA.
<P>
On output, FileInfoBuf is unchanged.  The buffer pointed to by fpFEAList
is filled in with the returned information.  If the buffer fpFEAList points
to isn't large enough to hold the returned information (ERROR_BUFFER_OVERFLOW)
cbList is still valid, assuming there's at least enough space for it.  Its
value is the size of the entire EA set for the file, even though only a
subset of attributes was requested. Following is the format of the FEAList
structure:<!-- lm: 0x2 7 -->
</UL><B> cbList</B> (ULONG)<!-- lm: 0x11 10 -->
<UL> Length
of the FEA list, including the length itself.<!-- lm: 0x2 7 -->
</UL><B> list
</B>(FEA)<!-- lm: 0x11 10 -->
<UL> List of FEA structures.  An FEA structure
has the following format:<!-- lm: 0x2 10 -->
<P>
<B>Flags</B> (BYTE)<!-- lm: 0x11 13 -->
<UL> Bit indicator describing the
characteristics of the EA being defined.<!-- lm: 0x2 13 -->
<P>
Bit<!-- lm: 0x2 23 -->
<UL> Description<!-- lm: 0x2 13 -->
</UL>7<!-- lm: 0x2 23 -->
<UL> Critical EA.<!-- lm: 0x2 13 -->
</UL>6-0<!-- lm: 0x2 23 -->
<UL> Reserved and must be set to zero.<!-- lm: 0x2 10 -->
</UL>  
<!-- lm: 0x11 13 -->
<UL>If bit 7 is set to 1, this indicates a critical
<!-- entering slot 138 --> EA.  If bit 7 is 0, this means the EA is noncritical;
that is, the EA is not essential to the intended use by an application of
the file with which it is associated.<!-- lm: 0x2 10 -->
</UL><B> cbName
</B>(BYTE)<!-- lm: 0x11 13 -->
<UL> Length of EA ASCIIZ name, which does
not include the null character.<!-- lm: 0x2 10 -->
</UL><B> cbValue</B> (USHORT)
<!-- lm: 0x11 13 -->
<UL>Length of EA value, which cannot exceed 64KB.<!-- lm: 0x2 10 -->
</UL><B> szName
</B>(PSZ)<!-- lm: 0x11 13 -->
<UL> Address of the ASCIIZ name of EA.<!-- lm: 0x2 10 -->
</UL><B> aValue
</B>(PSZ)<!-- lm: 0x11 13 -->
<UL> Address of the free-format value of EA.

<P>
<B>Note: </B> The szName and aValue fields are not included as part of header
or include files.  Because of their variable lengths, these entries must
be built manually.<!-- lm: 0x2 1 -->
</UL><!-- lm: 0x2 1 -->
<P>
<B>FileInfoBufSize</B> (USHORT) - output<!-- lm: 0x11 4 -->
<UL> Length
of FileInfoBuf.<!-- lm: 0x2 1 -->
</UL><B> rc</B> (USHORT) - return<!-- lm: 0x11 4 -->
<UL> Return
code descriptions are:<!-- lm: 0x2 4 -->
<P>
<LI><!-- lm: 0x2 14 -->NO_ERROR<!-- lm: 0x2 4 --> 5<!-- lm: 0x2 14 -->
<UL> ERROR_ACCESS_DENIED
<!-- lm: 0x2 4 -->
</UL>6<!-- lm: 0x2 14 -->
<UL> ERROR_INVALID_HANDLE<!-- lm: 0x2 4 -->
</UL>111<!-- lm: 0x2 14 -->
<UL> ERROR_BUFFER_OVERFLOW<!-- lm: 0x2 4 -->
</UL>124<!-- lm: 0x2 14 -->
<UL> ERROR_INVALID_LEVEL<!-- lm: 0x2 4 -->
</UL>130<!-- lm: 0x2 14 -->
<UL> ERROR_DIRECT_ACCESS_HANDLE<!-- lm: 0x2 4 -->
</UL>254<!-- lm: 0x2 14 -->
<UL> ERROR_INVALID_EA_NAME<!-- lm: 0x2 4 -->
</UL>255<!-- lm: 0x2 14 -->
<UL> ERROR_EA_LIST_INCONSISTENT<!-- lm: 0x2 1 -->
</UL><B>Remarks</B>
<P>
The FAT file system supports modification of only date and time information
contained in file information level 1. Zero is returned for the creation
and access dates and times.
<P>
To return information contained in any of the file information levels, DosQFileInfo
has to be able to read the open file.  DosQFileInfo works only when the
file is opened for read access, with a deny-write sharing mode specified
for access by other processes. If the file is already opened by another
process that has specified conflicting sharing and access modes, a call
to <A HREF="091_L2_DosOpen.html">DosOpen</A> or  <A HREF="092_L2_DosOpen2.html">DosOpen2
</A>fails.
<P>
<A HREF="030_L2_DosEnumAttribute.html">DosEnumAttribute</A> returns the
lengths of EAs.  This information can be used to calculate the size of FileInfoBuf
needed to hold full extended attribute (FEA) information returned by DosQFileInfo
when Level 3 is specified.  The size of the buffer is calculated as follows:
<!-- lm: 0x2 1 -->
<P>
One byte (for fea_usFlags) + 
<BR>
One byte (for fea_cbName) + 
<BR>
Two bytes (for fea_cbValue) + 
<BR>
Value of cbName (for the name of the EA) + 
<BR>
One byte (for terminating NULL in fea_cbName) + 
<BR>
Value of cbValue (for the value of the EA)<!-- lm: 0x2 1 -->
<BR>


<P><HR>

<A HREF="110_L2_DosQFHandState.html">[Back: DosQFHandState]</A> <BR>
<A HREF="112_L2_DosQFileMode.html">[Next: DosQFileMode]</A> 
</BODY>
</HTML>
