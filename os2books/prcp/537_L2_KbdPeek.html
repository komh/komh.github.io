<HTML>
<HEAD>
<TITLE>KbdPeek</TITLE>
</HEAD>
<BODY>
<H1>KbdPeek</H1><!-- entering slot 581 -->Bindings:  <A HREF="556_L2H_KbdPeek.html">C</A>,
<A HREF="575_L2H_KbdPeek.html">MASM</A>
<BR>

<P>
This call returns any available character data record from the keyboard
without removing it from the buffer.<!-- lm: 0x2 1 -->
<UL>
<P>
KbdPeek<!-- lm: 0x2 12 -->
<UL> (CharData, KbdHandle)<!-- lm: 0x2 1 -->
</UL><!-- lm: 0x2 1 -->
<P>
<B>CharData</B> (PKBDKEYINFO) - output<!-- lm: 0x11 4 -->
<UL> Address of
the character data information:<!-- lm: 0x2 4 -->
<P>
<B>asciicharcode</B> (UCHAR)<!-- lm: 0x11 7 -->
<UL> ASCII character code.
The scan code received from the keyboard is translated to the ASCII character
code.<!-- lm: 0x2 4 -->
</UL><B> scancode</B> (UCHAR)<!-- lm: 0x11 7 -->
<UL> Code
received from the keyboard hardware.<!-- lm: 0x2 4 -->
</UL><B> status</B> (UCHAR)
<!-- lm: 0x11 7 -->
<UL>State of the keystroke event:<!-- lm: 0x2 7 -->
<P>
Bit<!-- lm: 0x2 17 -->
<UL> Description<!-- lm: 0x2 7 -->
</UL> 7-6<!-- lm: 0x2 17 -->
<UL> 00
= Undefined.
<P>
01 = Final character, interim character flag off.
<P>
10 = Interim character.
<P>
11 = Final character, interim character flag on.<!-- lm: 0x2 7 -->
</UL> 5
<!-- lm: 0x2 17 -->
<UL>1 = Immediate conversion requested.<!-- lm: 0x2 7 -->
</UL> 4-2
<!-- lm: 0x2 17 -->
<UL>Reserved, set to zero.<!-- lm: 0x2 7 -->
</UL> 1
<!-- lm: 0x2 17 -->
<UL>0 = Scan code is a character.
<P>
1 = Scan code is not a character; it is an extended key code from the keyboard.
<!-- lm: 0x2 7 -->
</UL>0<!-- lm: 0x2 17 -->
<UL> 1 = Shift status returned
without character.<!-- lm: 0x2 4 -->
</UL><B> reserved</B> (UCHAR)<!-- lm: 0x11 7 -->
<UL> NLS
shift status.  Reserved, set to zero.<!-- lm: 0x2 4 -->
</UL><B> shiftkeystat
</B>(USHORT)<!-- lm: 0x11 7 -->
<UL> Shift key status.<!-- lm: 0x2 7 -->
<P>
Bit<!-- lm: 0x2 17 -->
<UL> Description<!-- lm: 0x2 7 -->
</UL>15<!-- lm: 0x2 17 -->
<UL> SysReq key down<!-- lm: 0x2 7 -->
</UL>14<!-- lm: 0x2 17 -->
<UL> CapsLock key down<!-- lm: 0x2 7 -->
</UL>13<!-- lm: 0x2 17 -->
<UL> NumLock key down<!-- lm: 0x2 7 -->
</UL>12<!-- lm: 0x2 17 -->
<UL> ScrollLock key down<!-- lm: 0x2 7 -->
</UL>11<!-- lm: 0x2 17 -->
<UL> Right Alt key down<!-- lm: 0x2 7 -->
</UL>10<!-- lm: 0x2 17 -->
<UL> Right Ctrl key down<!-- lm: 0x2 7 -->
</UL>9<!-- lm: 0x2 17 -->
<UL> Left Alt key down<!-- lm: 0x2 7 -->
</UL>8<!-- lm: 0x2 17 -->
<UL> Left Ctrl key down<!-- lm: 0x2 7 -->
</UL>7<!-- lm: 0x2 17 -->
<UL> Insert on<!-- lm: 0x2 7 -->
</UL>6<!-- lm: 0x2 17 -->
<UL> CapsLock on<!-- lm: 0x2 7 -->
</UL>5<!-- lm: 0x2 17 -->
<UL> NumLock on<!-- lm: 0x2 7 -->
</UL>4<!-- lm: 0x2 17 -->
<UL> ScrollLock on<!-- lm: 0x2 7 -->
</UL>3<!-- lm: 0x2 17 -->
<UL> Either Alt key down<!-- lm: 0x2 7 -->
</UL>2<!-- lm: 0x2 17 -->
<UL> Either Ctrl key down<!-- lm: 0x2 7 -->
</UL>1<!-- lm: 0x2 17 -->
<UL> Left Shift key down<!-- lm: 0x2 7 -->
</UL>0<!-- lm: 0x2 17 -->
<UL> Right Shift key down<!-- lm: 0x2 4 -->
</UL><B> time
</B>(ULONG)<!-- lm: 0x11 7 -->
<UL> Time stamp indicating when a key was
pressed.  It is specified in milliseconds from the time the system was started.
<!-- lm: 0x2 1 -->
</UL><B>KbdHandle</B> (HKBD) - input<!-- lm: 0x11 4 -->
<UL> Default
keyboard or the logical keyboard.<!-- lm: 0x2 1 -->
</UL><B> rc</B> (USHORT)
- return<!-- lm: 0x11 4 -->
<UL> Return code descriptions are:<!-- lm: 0x2 4 -->
<P>
<LI><!-- lm: 0x2 14 -->NO_ERROR<!-- lm: 0x2 4 --> 439<!-- lm: 0x2 14 -->
<UL> ERROR_KBD_INVALID_HANDLE
<!-- lm: 0x2 4 -->
</UL>445<!-- lm: 0x2 14 -->
<UL> ERROR_KBD_FOCUS_REQUIRED<!-- lm: 0x2 4 -->
</UL>447<!-- lm: 0x2 14 -->
<UL> ERROR_KBD_KEYBOARD_BUSY<!-- lm: 0x2 4 -->
</UL>464<!-- lm: 0x2 14 -->
<UL> ERROR_KBD_DETACHED<!-- lm: 0x2 4 -->
</UL>504<!-- lm: 0x2 14 -->
<UL> ERROR_KBD_EXTENDED_SG<!-- lm: 0x2 1 -->
</UL><B>Remarks</B>
<P>
On an enhanced keyboard, the secondary enter key returns the normal character
0DH and a scan code of E0H.
<P>
Double-byte character codes (DBCS) require two function calls to obtain
the entire code.
<P>
If shift report is set with <A HREF="542_L2_KbdSetStatus.html">KbdSetStatus
</A>the CharData record returned, reflects changed shift information only.

<P>
Extended ASCII codes are identified with the status byte, bit 1 on and the
ASCII character code being either 00H or E0H. Both conditions must be satisfied
for the character to be an extended keystroke.  For extended ASCII codes,
the scan code byte returned is the second code (extended code). Usually
the extended ASCII code is the scan code of the primary key that was pressed.

<P>
A thread in the foreground session that repeatedly polls the keyboard with
<A HREF="527_L2_KbdCharIn.html">KbdCharIn</A> (with no wait), can prevent
all regular priority class threads from executing.  If polling must be used
and a minimal amount of other processing is being performed, the thread
should periodically yield the CPU by issuing a DosSleep call for an interval
of at least 5 milliseconds.
<P>

<BR>
<B>Family API Considerations</B>
<P>
Some options operate differently in the DOS mode than in the OS/2 mode.
 Therefore, the following restrictions apply to KbdPeek when coding for
the DOS mode:<!-- lm: 0x2 1 -->
<P>
o<!-- entering slot 582 --><!-- lm: 0x2 3 -->
<UL> The CharData structure
includes everything except the time stamp.<!-- lm: 0x2 1 -->
</UL>o<!-- lm: 0x2 3 -->
<UL>Interim character is not supported.<!-- lm: 0x2 1 -->
</UL>o<!-- lm: 0x2 3 -->
<UL>Status can be 0 or 1.<!-- lm: 0x2 1 -->
</UL>o<!-- lm: 0x2 3 -->
<UL>KbdHandle is ignored.<!-- lm: 0x2 1 -->
</UL>

<P><HR>

<A HREF="536_L2_KbdOpen.html">[Back: KbdOpen]</A> <BR>
<A HREF="538_L2_KbdRegister.html">[Next: KbdRegister]</A> 
</BODY>
</HTML>
