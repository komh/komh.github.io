<HTML>
<HEAD>
<META HTTP-EQUIV="CONTENT-TYPE" CONTENT="TEXT/HTML; CHARSET=UTF-8">
<TITLE>Finding the System Queue</TITLE>
<STYLE>
PRE {
  FONT-FAMILY: Consolas, "Lucida Console", "Courier New", Courier, MONOSPACE;
}
</STYLE>
</HEAD>
<BODY>
<H1>Finding the System Queue</H1><!-- entering slot 309 -->
<PRE>##dw mqhsysqueue
fd87:00000000  0000 001c 001a 0078 0ad6 17f6 0ee2 11ba
fd87:00000010  0000 0006 0007 0007 0000 0001 0001 ebe7
fd87:00000020  06d6 0008 0ba5 0000 0000 e55f 072a 0048
fd87:00000030  000f 000b 0002 0000 0300 0000 0000 0000
fd87:00000040  0000 fffe ee6f 2549 0000 0000 0000 0588
fd87:00000050  0339 032c 00ac 00bc 00cc 00dc 00ec 00fc
fd87:00000060  010c 012c 011c 013c 014c 015c 0000 0000
fd87:00000070  0000 0000 0000 0000 0000 0000 0000 0000
##dw ee2
fd87:00000ee2  0072 00f5 005d 02fe 0000 dbc2 2549 8000
fd87:00000ef2  0000 8000 0000 9150 08a8 08a8 0070 0032
fd87:00000f02  00ec 0000 0000 dfaa 2549 0000 c3b7 fff6
fd87:00000f12  2002 0000 0012 08a8 0071 0032 00ec 83fe
fd87:00000f22  0000 e007 2549 fff6 2002 0000 0012 08a8
fd87:00000f32  e007 08a8 0072 0032 00ec 03fe 0000 e065
fd87:00000f42  2549 2006 0000 0016 0000 2006 08a8 08a8
fd87:00000f52  0071 0032 00ec 82fe 0000 e0c3 2549 0000
</PRE>

<P>
<B>mhsysqueue</B> points directly at the system queue.
<P>
The queue pointers are offsets from the same segment as the MQ.
<P>
The current read pointer at +0x0e, is 0x0ee2.
<P>
The queue entry length at +0x02,  is 0x001c.
<P>
Displaying the queue from the read pointer shows the first few elements
queued are for message IDs, 72, 70, 71, 72 and so on.
<P>
Each entry on the system queue is a<B> SQMSG</B>. The key fields are:<!-- lm: 0x2 1 -->
<UL>
<P>
Offset<!-- lm: 0x2 11 -->
<UL> Description<!-- lm: 0x2 1 -->
</UL> +0x0
<!-- lm: 0x2 11 -->
<UL>Message ID<!-- lm: 0x2 1 -->
</UL> +0x2<!-- lm: 0x2 11 -->
<UL>Message
Parameter 1<!-- lm: 0x2 1 -->
</UL> +0x6<!-- lm: 0x2 11 -->
<UL>Message
Parameter 2<!-- lm: 0x2 1 -->
</UL>
<P>
For an application queue, the entries are<B> QMSG</B> structures. the key
fields of these are:<!-- lm: 0x2 1 -->
<P>
Offset<!-- lm: 0x2 21 -->
<UL> Description<!-- lm: 0x2 1 -->
</UL> +0x0
<!-- lm: 0x2 21 -->
<UL>HWND<!-- lm: 0x2 1 -->
</UL> +0x4<!-- lm: 0x2 21 -->
<UL>Message
Id<!-- lm: 0x2 1 -->
</UL> +0x8<!-- lm: 0x2 21 -->
<UL>Message Parameter
1<!-- lm: 0x2 1 -->
</UL> +0xc<!-- lm: 0x2 21 -->
<UL>Message Parameter
2<!-- lm: 0x2 1 -->
</UL>

<P><HR>

<A HREF="210_L5_FindingaBadAppProces.html">[Back: Finding a BadApp Process and MQ]</A> <BR>
<A HREF="212_L3_DumpAnalysisofLoopsi.html">[Next: Dump Analysis of Loops in Ring 0 Code]</A> 
</BODY>
</HTML>
