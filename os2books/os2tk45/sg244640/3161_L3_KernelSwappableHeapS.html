<HTML>
<HEAD>
<TITLE>Kernel Swappable Heap Structures</TITLE>
</HEAD>
<BODY>
<H1>Kernel Swappable Heap Structures</H1><!-- entering slot 3404 --> 
<P>
<!-- lm: 0x2 1 -->
<UL>
<P>
<B>Pointers</B><!-- lm: 0x11 11 -->
<UL> For swappable heap entries,<B> kh_pksh
</B>of a VMKH entry points to a VMKSH.
<P>
An array of VMKRHY structures are embedded in VMKRH at<B> krh_akrhy</B>.

<P>
An array of VMKRHS structures are embedded in VMKRH at<B> krh_akrhs</B>.

<P>
<B>ksh_hdrEntry</B> in VMKSH points to the first chained VMKSHD.
<P>
<B>kshd_pbNext</B> in VMKSHD points to subsequent VMKSHD structures. VMKRHF
structures from the dummy VMKRHF embedded in VMKRK at<B> krh_krhfDummy</B><!-- lm: 0x2 1 -->
</UL><B> Locations
</B><!-- lm: 0x11 11 -->
<UL>System Arena.
<P>
VMKSHD structure are allocated from the Kernel Resident Heap.
<P>
VMKSH prefixes a swappable heap.
<P>
Allocated blocks (VMKSHB) are sparsely allocated from the heap.
<P>
VMKSHB prefixes the data portion of an allocated block.<!-- lm: 0x2 1 -->
</UL><B> VM
Owners</B><!-- lm: 0x11 11 -->
<UL><!-- lm: 0x2 11 -->
<P>
VMKSH and VMKSHB:<!-- lm: 0x11 26 -->
<UL><B> vmkshro (0xffee)</B>
<P>
<B>vmkshrw (0xffef)</B>.<!-- lm: 0x2 11 -->
</UL> VMKSHD:<!-- lm: 0x11 26 -->
<UL><B> vmshd
(0xffed)</B>.<!-- lm: 0x2 11 --><!-- lm: 0x2 1 -->
</UL> 
<P>
<B><A HREF="3252_L0_.html">Format</A></B> 
<P>
<B>VMKSH</B> Kernel Swappable Heap Header (RETAIL kernel)
<PRE>зддддддддддддддддбддддддбддддддбддддбдддддддддддддддддддддддддддддддддддддддд©Ё<I>Field Name</I>      Ё<I>Offset</I>Ё<I>Length</I>Ё<I>Type</I>Ё<I>Description</I>                             Ё
цддддддддддддддддеддддддеддддддеддддедддддддддддддддддддддддддддддддддддддддд╢
Ёksh_hdrEntry    Ё+0    Ё12    ЁS   ЁDummy head descriptor of free chain     Ё
цддддддддддддддддеддддддеддддддеддддедддддддддддддддддддддддддддддддддддддддд╢
Ё                Ё+0    Ё4     ЁD   Ё                                        Ё
цддддддддддддддддеддддддеддддддеддддедддддддддддддддддддддддддддддддддддддддд╢
Ё                Ё+4    Ё4     ЁD   Ёpointer to next descriptor              Ё
цддддддддддддддддеддддддеддддддеддддедддддддддддддддддддддддддддддддддддддддд╢
Ё                Ё+8    Ё4     ЁD   Ё                                        Ё
цддддддддддддддддеддддддеддддддеддддедддддддддддддддддддддддддддддддддддддддд╢
цддддддддддддддддеддддддеддддддеддддедддддддддддддддддддддддддддддддддддддддд╢
Ёksh_pHint       Ё+c    Ё4     ЁD   ЁDescriptor pointer to last block touchedЁ
цддддддддддддддддеддддддеддддддеддддедддддддддддддддддддддддддддддддддддддддд╢
Ёksh_pHPrev      Ё+10   Ё4     ЁD   ЁDescriptor pointer to PrevBlk of last   Ё
Ё                Ё      Ё      Ё    Ёtouched                                 Ё
цддддддддддддддддеддддддеддддддеддддедддддддддддддддддддддддддддддддддддддддд╢
Ёksh_HintSize    Ё+14   Ё4     ЁD   ЁSize of last block touched              Ё
цддддддддддддддддеддддддеддддддеддддедддддддддддддддддддддддддддддддддддддддд╢
Ёksh_pbEndRes    Ё+18   Ё4     ЁD   ЁUpper bound of reserved virt mem        Ё
цддддддддддддддддеддддддеддддддеддддедддддддддддддддддддддддддддддддддддддддд╢
Ёksh_pbEndCom    Ё+1c   Ё4     ЁD   ЁUpper bound of committed virt mem       Ё
цддддддддддддддддеддддддеддддддеддддедддддддддддддддддддддддддддддддддддддддд╢
Ёksh_fl          Ё+20   Ё4     ЁD   ЁSwappable heap allocation flags         Ё
цддддддддддддддддеддддддеддддддеддддедддддддддддддддддддддддддддддддддддддддд╢
Ёksh_hob         Ё+24   Ё2     ЁW   ЁHeap object handle                      Ё
цддддддддддддддддеддддддеддддддеддддедддддддддддддддддддддддддддддддддддддддд╢
Ёksh_pbStart     Ё+26   Ё4     ЁD   ЁLower bound of reserved virt mem        Ё
цддддддддддддддддеддддддеддддддеддддедддддддддддддддддддддддддддддддддддддддд╢
Ёksh_ksem        Ё+2a   ЁC     ЁS   ЁKSEM for swappable heap                 Ё
юддддддддддддддддаддддддаддддддаддддадддддддддддддддддддддддддддддддддддддддды
</PRE>
 
<P>
<B>VMKSH</B> Kernel Swappable Heap Header (<B>ALLSTRICT</B> kernel)
<PRE>зддддддддддддддддбддддддбддддддбддддбдддддддддддддддддддддддддддддддддддддддд©
Ё<I>Field Name</I>      Ё<I>Offset</I>Ё<I>Length</I>Ё<I>Type</I>Ё<I>Description</I>                             Ё
цддддддддддддддддеддддддеддддддеддддедддддддддддддддддддддддддддддддддддддддд╢
Ёksh_hdrEntry    Ё+0    Ё4     ЁD   ЁHead of descriptor chain                Ё
цддддддддддддддддеддддддеддддддеддддедддддддддддддддддддддддддддддддддддддддд╢
Ёksh_pHint       Ё+4    Ё4     ЁD   ЁDescriptor pointer to last block touchedЁ
цддддддддддддддддеддддддеддддддеддддедддддддддддддддддддддддддддддддддддддддд╢
Ёksh_pHPrev      Ё+8    Ё4     ЁD   ЁDescriptor pointer to PrevBlk of last   Ё
Ё                Ё      Ё      Ё    Ёtouched                                 Ё
цддддддддддддддддеддддддеддддддеддддедддддддддддддддддддддддддддддддддддддддд╢
Ёksh_HintSize    Ё+C    Ё4     ЁD   ЁSize of last block touched              Ё
цддддддддддддддддеддддддеддддддеддддедддддддддддддддддддддддддддддддддддддддд╢
Ёksh_pbEndRes    Ё+10   Ё4     ЁD   ЁUpper bound of reserved virt mem        Ё
цддддддддддддддддеддддддеддддддеддддедддддддддддддддддддддддддддддддддддддддд╢
Ёksh_pbEndCom    Ё+14   Ё4     ЁD   ЁUpper bound of committed virt mem       Ё
цддддддддддддддддеддддддеддддддеддддедддддддддддддддддддддддддддддддддддддддд╢
Ёksh_fl          Ё+18   Ё4     ЁD   ЁSwappable heap allocation flags         Ё
цддддддддддддддддеддддддеддддддеддддедддддддддддддддддддддддддддддддддддддддд╢
Ёksh_hob         Ё+1C   Ё2     ЁW   ЁHeap object handle                      Ё
цддддддддддддддддеддддддеддддддеддддедддддддддддддддддддддддддддддддддддддддд╢
Ёksh_pbStart     Ё+1E   Ё4     ЁD   ЁLower bound of reserved virt mem        Ё
цддддддддддддддддеддддддеддддддеддддедддддддддддддддддддддддддддддддддддддддд╢
Ёksh_ksem        Ё+22   Ё10    ЁS   ЁKSEM for swappable heap                 Ё
цддддддддддддддддеддддддеддддддеддддедддддддддддддддддддддддддддддддддддддддд╢
Ёksh_ckshds      Ё+32   Ё4     ЁD   ЁCount of heap modifications             Ё
цддддддддддддддддеддддддеддддддеддддедддддддддддддддддддддддддддддддддддддддд╢
Ёksh_cFrees      Ё+36   Ё4     ЁD   ЁCount of heap modifications             Ё
цддддддддддддддддеддддддеддддддеддддедддддддддддддддддддддддддддддддддддддддд╢
Ёksh_cAllocs     Ё+3a   Ё4     ЁD   ЁCount of heap modifications             Ё
юддддддддддддддддаддддддаддддддаддддадддддддддддддддддддддддддддддддддддддддды
</PRE>
 
<P>
<B>VMKSHD</B> Kernel Swappable Heap Descriptor Record for  Free Blocks.

<PRE>зддддддддддддддддбддддддбддддддбддддбдддддддддддддддддддддддддддддддддддддддд©
Ё<I>Field Name</I>      Ё<I>Offset</I>Ё<I>Length</I>Ё<I>Type</I>Ё<I>Description</I>                             Ё
цддддддддддддддддеддддддеддддддеддддедддддддддддддддддддддддддддддддддддддддд╢
Ёkshb_size       Ё+0    Ё4     ЁD   ЁSize of block in dwords                 Ё
цддддддддддддддддеддддддеддддддеддддедддддддддддддддддддддддддддддддддддддддд╢
Ёkshd_pNext      Ё+4    Ё4     ЁD   ЁNext free block                         Ё
цддддддддддддддддеддддддеддддддеддддедддддддддддддддддддддддддддддддддддддддд╢
Ёkshd_pb         Ё+8    Ё4     ЁD   ЁAddress of block header                 Ё
юддддддддддддддддаддддддаддддддаддддадддддддддддддддддддддддддддддддддддддддды
</PRE>
 
<P>
<B>VMKSHB</B>  Kernel Swappable Heap Block Header for Allocated blocks.

<PRE>зддддддддддддддддбддддддбддддддбддддбдддддддддддддддддддддддддддддддддддддддд©
Ё<I>Field Name</I>      Ё<I>Offset</I>Ё<I>Length</I>Ё<I>Type</I>Ё<I>Description</I>                             Ё
цддддддддддддддддеддддддеддддддеддддедддддддддддддддддддддддддддддддддддддддд╢
Ё                Ё+0    Ё1     ЁD   ЁSignature 0x52                          Ё
цддддддддддддддддеддддддеддддддеддддедддддддддддддддддддддддддддддддддддддддд╢
Ёkshb_size       Ё      Ё3     Ё    Ёsize of block                           Ё
цддддддддддддддддеддддддеддддддеддддедддддддддддддддддддддддддддддддддддддддд╢
Ёkshb_hobowner   Ё+4    Ё2     ЁW   ЁOwner                                   Ё
цддддддддддддддддеддддддеддддддеддддедддддддддддддддддддддддддддддддддддддддд╢
Ёkshb_sel        Ё+6    Ё2     ЁW   ЁSelector                                Ё
юддддддддддддддддаддддддаддддддаддддадддддддддддддддддддддддддддддддддддддддды
</PRE>
 
<P>
<B>ksh_fl</B> flag definitions.
<PRE>зддддддддддддддбддддддддддбддддддддддддддддддддддддддддддддд©
ЁName          ЁBit Mask  ЁDescription                      Ё
цддддддддддддддеддддддддддеддддддддддддддддддддддддддддддддд╢
ЁPG_CONTIG     Ё0x00000001Ёcontiguous physical memory       Ё
цддддддддддддддеддддддддддеддддддддддддддддддддддддддддддддд╢
ЁPG_NOINCR     Ё0x00000001Ёdon't increment physical addrs   Ё
цддддддддддддддеддддддддддеддддддддддддддддддддддддддддддддд╢
ЁPG_W          Ё0x00000002ЁWritable - value from pte        Ё
цддддддддддддддеддддддддддеддддддддддддддддддддддддддддддддд╢
ЁPG_U          Ё0x00000004Ёuser mode accessible - from pte  Ё
цддддддддддддддеддддддддддеддддддддддддддддддддддддддддддддд╢
ЁPG_X          Ё0x00000008ЁeXecutable                       Ё
цддддддддддддддеддддддддддеддддддддддддддддддддддддддддддддд╢
ЁPG_R          Ё0x00000010ЁReadable                         Ё
цддддддддддддддеддддддддддеддддддддддддддддддддддддддддддддд╢
ЁPG_1M         Ё0x00000020Ёmust reside below 1 meg physical Ё
цддддддддддддддеддддддддддеддддддддддддддддддддддддддддддддд╢
ЁPG_GUARD      Ё0x00000040Ёguard page - from pte            Ё
цддддддддддддддеддддддддддеддддддддддддддддддддддддддддддддд╢
ЁPG_16M        Ё0x00000040Ёmust reside below 16 meg physicalЁ
цддддддддддддддеддддддддддеддддддддддддддддддддддддддддддддд╢
ЁPG_ZEROFILL   Ё0x00000080Ёzero initialize pages            Ё
цддддддддддддддеддддддддддеддддддддддддддддддддддддддддддддд╢
ЁPG_SWAPONWRITEЁ<!-- entering slot 3405 -->0x00000100Ёvalue from vp                    Ё
цддддддддддддддеддддддддддеддддддддддддддддддддддддддддддддд╢
ЁPG_UVIRT      Ё0x00000200Ёvalue from pte                   Ё
цддддддддддддддеддддддддддеддддддддддддддддддддддддддддддддд╢
ЁPG_RESIDENT   Ё0x00000400Ёvalue from pte                   Ё
цддддддддддддддеддддддддддеддддддддддддддддддддддддддддддддд╢
ЁPG_DISCARDABLEЁ0x00000800Ёvalue from vp                    Ё
юддддддддддддддаддддддддддаддддддддддддддддддддддддддддддддды
</PRE>


<P><HR>

<A HREF="3160_L3_KernelResidentHeapSt.html">[Back: Kernel Resident Heap Structures]</A> <BR>
<A HREF="3162_L2_SchedulerThreadandPr.html">[Next: Scheduler Thread and Process Control Block Reference]</A> 
</BODY>
</HTML>
