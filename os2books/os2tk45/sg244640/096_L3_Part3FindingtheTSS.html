<HTML>
<HEAD>
<TITLE>Part 3: Finding the TSS</TITLE>
</HEAD>
<BODY>
<H1>Part 3: Finding the TSS</H1><!-- entering slot 119 -->
<P>
It is relatively simple to find and display this critical control block
which is used by the hardware for ring transitions.<!-- lm: 0x2 2 -->
<UL>
<P>
 <LI><LI><!-- lm: 0x2 6 -->Get the debug kernel's attention, so you can
display data.<!-- lm: 0x2 2 -->
<P>
 <LI><LI><!-- lm: 0x2 6 -->The TSS is located via the Task Register (TR),
which is a selctor.<!-- lm: 0x2 1 -->
</UL> You can find the value in TR
by entering  ? TR
<P>
Entering RT toggles register terse mode.  Try  R before and after entering
RT.  You can look for TR in the output.
<P>
You really do not want TR, but the TSS, which is at  TR:0.<!-- lm: 0x2 2 -->
<UL>
<P>
 <LI><LI><!-- lm: 0x2 6 -->Enter<!-- lm: 0x2 1 -->
</UL>    DD TR:0 to display
the TSS as doublewords
<P>
   DT TR:0 to format the TSS.<!-- lm: 0x2 2 -->
<UL>
<P>
 <LI><LI><!-- lm: 0x2 6 -->The first doubleword is the link field.<!-- lm: 0x2 1 -->
</UL> It
indicates which TSS called this one through a task gate.
<P>
The next two doublewords are the ESP and SS for entry to ring 0.
<P>
The next pair of doublewords are unused by OS/2; they would have the ESP
and SS for entry into ring 1.
<P>
The next pair of doublewords are the ESP and SS for entry to ring 2.<!-- lm: 0x2 2 -->
<UL>
<P>
 <LI><LI><!-- lm: 0x2 6 -->To display the stack used at entry to ring 0,
<!-- lm: 0x2 1 -->
</UL>use the DD command with the SS and ESP values from
the TSS;  BUT Stacks grow downward, so put -80 after the ESP value.  80
is the number of bytes displayed by default; this will show you the top
of the stack for ring 0, with the saved SS value as the last item shown.
<!-- lm: 0x2 1 -->
<BR>


<P><HR>

<A HREF="095_L3_Part2SomeTechniques.html">[Back: Part 2: Some Techniques]</A> <BR>
<A HREF="097_L3_Part4WatchingaRingTr.html">[Next: Part 4: Watching a Ring Transition]</A> 
</BODY>
</HTML>
