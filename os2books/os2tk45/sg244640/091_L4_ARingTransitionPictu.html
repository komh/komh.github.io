<HTML>
<HEAD>
<META HTTP-EQUIV="CONTENT-TYPE" CONTENT="TEXT/HTML; CHARSET=UTF-8">
<TITLE>A Ring Transition Picture</TITLE>
</HEAD>
<BODY>
<H1>A Ring Transition Picture</H1><!-- entering slot 112 -->
<P>
The following is how the stacks look at entry to the more privileged program:

<PRE>    RING 3 STACK                  RING 0 STACK  &lt;-- INITIAL R0 ESP
   ---------------      high     ---------------
  |               |  addresses  |      SS       |
  |---------------|             |---------------|
  |       P3      |             |     ESP       |
  |---------------|             |---------------|
  |       P2      |             |      P3       |
  |---------------|             |---------------|
  |       P1      |             |      P2       |
  |---------------|             |---------------|
  |       P0      |             |      P1       |
  |---------------|             |---------------|
  |               |             |      P0       |
  |---------------|             |---------------|
  |               |             |      CS       |
  |---------------|             |---------------|
  |               |             |     EIP       |
  |---------------|             |---------------|
  |               |     low     |               |
                     addresses
</PRE>

<P>
<B>Note: </B> There is NO RETURN ADDRESS on the less privileged stack.
<P>
<B>Note: </B> The two items at the top of the more privileged stack are
the less privileged SS and ESP.
<P>
<B>Note: </B> Subtract 8 from the SP value found in the TSS to find where
the less privileged ESP and SS are stored. The values in the TSS are initial
values, not the address of the first item pushed.
<P>
<B>Note: </B> A trap C in Ring 0 is usually a double fault.
<P>
When the processor detects a Stack Exception it needs to push an error code
and a return address onto the stack of the exception handler. If this happens
in Ring 0, there will be no privilege level transition, which includes switching
to a new, protected stack. If the exception is due to stack growth, there
is no place to push the error code or return address.
<P>
RESULT: TRAP 8

<P><HR>

<A HREF="090_L4_CallGateDetail.html">[Back: Call Gate Detail]</A> <BR>
<A HREF="092_L4_ReturnDetail.html">[Next: Return Detail]</A> 
</BODY>
</HTML>
