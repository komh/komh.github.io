<HTML>
<HEAD>
<TITLE>Kernel Resident Heap Structures</TITLE>
</HEAD>
<BODY>
<H1>Kernel Resident Heap Structures</H1><!-- entering slot 3402 --> 
<P>
<!-- lm: 0x2 1 -->
<UL>
<P>
<B>Pointers</B><!-- lm: 0x11 11 -->
<UL> For resident heap entries,<B> kh_pkrh
</B>of a VMKH entry points to a VMKRH.
<P>
An array of VMKRHY structures are embedded in VMKRH at<B> krh_akrhy</B>.

<P>
An array of VMKRHS structures are embedded in VMKRH at<B> krh_akrhs</B>.

<P>
<B>krhf_pbNext</B> and<B> krhb_pbPrev</B> double link VMKRHF structures
from the dummy VMKRHF embedded in VMKRK at<B> krh_krhfDummy</B><!-- lm: 0x2 1 -->
</UL><B> Locations
</B><!-- lm: 0x11 11 -->
<UL>System Arena.
<P>
VMKRH prefixes a resident heap.
<P>
Allocated blocks (VMKRHB and VMKRHBA) are sparsely allocated from the heap,
with interstitial free blocks (VMKRHF).
<P>
VMKRHB prefixes the data portion of an allocated block.
<P>
VMKRHBA suffixes the data portion of an allocated block when the<B> krhb_attr
</B>bit is set in the associated VMKRHB.<!-- lm: 0x2 1 -->
</UL><B> VM Owners
</B><!-- lm: 0x11 11 -->
<UL><B>vmkrhro (0xffeb)</B>
<P>
<B>vmkrhrw (0xffec)</B>
<P>
<B>kdbsym (0xff7c)</B>
<P>
<B>krhrw1m (0xff43)</B>
<P>
<B>krhro1m (0xff44)</B><!-- lm: 0x2 1 -->
</UL> 
<P>
<B><A HREF="3252_L0_.html">Format</A></B> 
<P>
<B>VMKRH</B> Kernel Resident Heap Header.
<PRE>зддддддддддддддддбддддддбддддддбддддбдддддддддддддддддддддддддддддддддддддддд©Ё<I>Field Name</I>      Ё<I>Offset</I>Ё<I>Length</I>Ё<I>Type</I>Ё<I>Description</I>                             Ё
цддддддддддддддддеддддддеддддддеддддедддддддддддддддддддддддддддддддддддддддд╢
Ёkrh_cBlocks     Ё+0    Ё4     ЁD   ЁCount of heap blocks                    Ё
цддддддддддддддддеддддддеддддддеддддедддддддддддддддддддддддддддддддддддддддд╢
Ёkrh_cFreeBlocks Ё+4    Ё4     ЁD   ЁCount of free heap blocks               Ё
цддддддддддддддддеддддддеддддддеддддедддддддддддддддддддддддддддддддддддддддд╢
Ёkrh_pbFirst     Ё+8    Ё4     ЁD   ЁFirst Heap Block                        Ё
цддддддддддддддддеддддддеддддддеддддедддддддддддддддддддддддддддддддддддддддд╢
Ёkrh_pbLast      Ё+C    Ё4     ЁD   ЁLast Heap Block                         Ё
цддддддддддддддддеддддддеддддддеддддедддддддддддддддддддддддддддддддддддддддд╢
Ёkrh_pbEndRes    Ё+10   Ё4     ЁD   ЁUpper bound of reserved virt mem        Ё
цддддддддддддддддеддддддеддддддеддддедддддддддддддддддддддддддддддддддддддддд╢
Ёkrh_pbEndCom    Ё+14   Ё4     ЁD   ЁUpper bound of committed virt mem       Ё
цддддддддддддддддеддддддеддддддеддддедддддддддддддддддддддддддддддддддддддддд╢
Ёkrh_lpgBase     Ё+18   Ё4     ЁD   ЁStart lin page of heap object           Ё
цддддддддддддддддеддддддеддддддеддддедддддддддддддддддддддддддддддддддддддддд╢
Ёkrh_cMods       Ё+1C   Ё4     ЁD   ЁCount of heap modifications             Ё
цддддддддддддддддеддддддеддддддеддддедддддддддддддддддддддддддддддддддддддддд╢
Ёkrh_fl          Ё+20   Ё4     ЁD   ЁResident heap flags                     Ё
цддддддддддддддддеддддддеддддддеддддедддддддддддддддддддддддддддддддддддддддд╢
Ёkrh_krhfDummy   Ё+24   ЁC     ЁD   ЁDummy free block                        Ё
цддддддддддддддддеддддддеддддддеддддедддддддддддддддддддддддддддддддддддддддд╢
Ёkrh_pkrhsLast   Ё+30   Ё4     ЁD   ЁLast Freelist Section Pointer           Ё
цддддддддддддддддеддддддеддддддеддддедддддддддддддддддддддддддддддддддддддддд╢
Ёkrh_akrhy       Ё+34   Ё30    ЁS   ЁArray of 8 yield structures             Ё
цддддддддддддддддеддддддеддддддеддддедддддддддддддддддддддддддддддддддддддддд╢
Ёkrh_akrhs       Ё+64   Ё50    ЁS   ЁArray of 5 free list sections           Ё
цддддддддддддддддеддддддеддддддеддддедддддддддддддддддддддддддддддддддддддддд╢
Ёkrh_hob         Ё+B4   Ё2     ЁW   ЁHeap object handle                      Ё
цддддддддддддддддеддддддеддддддеддддедддддддддддддддддддддддддддддддддддддддд╢
Ёkrh_ksem        Ё+B6   ЁC(10) ЁS   ЁKSEM for resident heap                  Ё
юддддддддддддддддаддддддаддддддаддддадддддддддддддддддддддддддддддддддддддддды
</PRE>
 
<P>
<B>VMKRHY</B> Kernel Resident Heap Yield List Structure.
<PRE>зддддддддддддддддбддддддбддддддбддддбдддддддддддддддддддддддддддддддддддддддд©
Ё<I>Field Name</I>      Ё<I>Offset</I>Ё<I>Length</I>Ё<I>Type</I>Ё<I>Description</I>                             Ё
цддддддддддддддддеддддддеддддддеддддедддддддддддддддддддддддддддддддддддддддд╢
Ёkrhy_pb         Ё+0    Ё4     ЁD   ЁBlock pointer                           Ё
цддддддддддддддддеддддддеддддддеддддедддддддддддддддддддддддддддддддддддддддд╢
Ёkrhy_cyield     Ё+4    Ё2     ЁW   ЁYield count                             Ё
юддддддддддддддддаддддддаддддддаддддадддддддддддддддддддддддддддддддддддддддды
</PRE>
 
<P>
<B>VMKRHS</B> Kernel Resident Heap Free List Anchor Structure.
<PRE>зддддддддддддддддбддддддбддддддбддддбдддддддддддддддддддддддддддддддддддддддд©
Ё<I>Field Name</I>      Ё<I>Offset</I>Ё<I>Length</I>Ё<I>Type</I>Ё<I>Description</I>                             Ё
цддддддддддддддддеддддддеддддддеддддедддддддддддддддддддддддддддддддддддддддд╢
Ёkrhs_cbMax      Ё+0    Ё4     ЁD   ЁMaximum block size                      Ё
цддддддддддддддддеддддддеддддддеддддедддддддддддддддддддддддддддддддддддддддд╢
Ёkrhs_krhfHead   Ё+4    ЁC     ЁS   ЁDummy free block used to locate head of Ё
Ё                Ё      Ё      Ё    Ёlist                                    Ё
юддддддддддддддддаддддддаддддддаддддадддддддддддддддддддддддддддддддддддддддды
</PRE>
 
<P>
<B>VMKRHF</B> Kernel Resident Heap Free Block.
<PRE>зддддддддддддддддбддддддбддддддбддддбдддддддддддддддддддддддддддддддддддддддд©
Ё<I>Field Name</I>      Ё<I>Offset</I>Ё<I>Length</I>Ё<I>Type</I>Ё<I>Description</I>                             Ё
цддддддддддддддддеддддддеддддддеддддедддддддддддддддддддддддддддддддддддддддд╢
Ёkrhf_struct0    Ё+0    Ё4     ЁS   ЁResident Heap Block Header              Ё
цддддддддддддддддеддддддеддддддеддддедддддддддддддддддддддддддддддддддддддддд╢
Ёkrhf_pbNext     Ё+4    Ё4     ЁD   ЁForward freelist link                   Ё
цддддддддддддддддеддддддеддддддеддддедддддддддддддддддддддддддддддддддддддддд╢
Ёkrhf_pbPrev     Ё+8    Ё4     ЁD   ЁBackward freelist link                  Ё
юддддддддддддддддаддддддаддддддаддддадддддддддддддддддддддддддддддддддддддддды
</PRE>
 
<P>
<B>VMKRHB</B> Kernel Resident Heap Block Header.
<PRE>зддддддддддддддддбддддддбддддддбддддбдддддддддддддддддддддддддддддддддддддддд©
Ё<I>Field Name</I>      Ё<I>Offset</I>Ё<I>Length</I>Ё<I>Type</I>Ё<I>Description</I>                             Ё
цддддддддддддддддеддддддеддддддеддддедддддддддддддддддддддддддддддддддддддддд╢
Ё                Ё+0    Ё4     ЁS   ЁRegular Block Header                    Ё
цддддддддддддддддеддддддеддддддеддддедддддддддддддддддддддддддддддддддддддддд╢
Ёkrhb_hobowner   Ё+0    Ё2     ЁD   ЁOwner                                   Ё
цддддддддддддддддеддддддеддддддеддддедддддддддддддддддддддддддддддддддддддддд╢
Ёkrhb_pfree      Ё      Ё0.1   Ё    ЁPreceding block is free                 Ё
цддддддддддддддддеддддддеддддддеддддедддддддддддддддддддддддддддддддддддддддд╢
Ёkrhb_usSize     Ё      Ё1.5   Ё    ЁSize of block in dwords                 Ё
цддддддддддддддддеддддддеддддддеддддедддддддддддддддддддддддддддддддддддддддд╢
Ёkrhb_yield      Ё      Ё0.1   Ё    ЁThread-yielded-here flag                Ё
цддддддддддддддддеддддддеддддддеддддедддддддддддддддддддддддддддддддддддддддд╢
Ёkrhb_attr       Ё      Ё0.1   Ё    ЁAttributed block flag (=0)              Ё
цддддддддддддддддеддддддеддддддеддддедддддддддддддддддддддддддддддддддддддддд╢
цддддддддддддддддеддддддеддддддеддддедддддддддддддддддддддддддддддддддддддддд╢
Ё                Ё+0    Ё4     ЁS   ЁAttributed Block Header                 Ё
цддддддддддддддддеддддддеддддддеддддедддддддддддддддддддддддддддддддддддддддд╢
Ё                Ё+0    Ё0.1   ЁD   ЁAttributed block is free                Ё
цддддддддддддддддеддддддеддддддеддддедддддддддддддддддддддддддддддддддддддддд╢
Ё                Ё      Ё0.1   Ё    ЁBlock preceding attributed block is freeЁ
цддддддддддддддддеддддддеддддддеддддедддддддддддддддддддддддддддддддддддддддд╢
Ёkrhb_ulSize     Ё      Ё3.4   Ё    ЁSize of block in dwords                 Ё
цддддддддддддддддеддддддеддддддеддддедддддддддддддддддддддддддддддддддддддддд╢
Ёkrhb_yield      Ё      Ё0.1   Ё    ЁThread-yielded-here flag                Ё
цддддддддддддддддеддддддеддддддеддддедддддддддддддддддддддддддддддддддддддддд╢
Ёkrhb_attr       Ё      Ё0.1   Ё    ЁAttributed block flag (=1)              Ё
юддддддддддддддддаддддддаддддддаддддадддддддддддддддддддддддддддддддддддддддды
</PRE>
 
<P>
<B>VMKRHBA</B> Kernel Resident Heap Block Header Attributes.
<PRE>зддддддддддддддддбддддддбддддддбддддбдддддддддддддддддддддддддддддддддддддддд©
Ё<I>Field Name</I>      Ё<I>Offset</I>Ё<I>Length</I>Ё<I>Type</I>Ё<I>Description</I>                             Ё
цддддддддддддддддеддддддеддддддеддддедддддддддддддддддддддддддддддддддддддддд╢
Ёkhba_sel        Ё+0    Ё2     ЁW   ЁSelector mapping heap block data        Ё
цддддддддддддддддеддддддеддддддеддддедддддддддддддддддддддддддддддддддддддддд╢
Ёkhba_hobOwner   Ё+2    Ё2     ЁW   ЁHeap block owner                        Ё
цддддддддддддддддеддддддеддддддеддддедддддддддддддддддддддддддддддддддддддддд╢
Ёkhba_hobMTE     Ё+4    Ё2     ЁW   ЁHeap block MTE                          Ё
цддддддддддддддддеддддддеддддддеддддедддддддддддддддддддддддддддддддддддддддд╢
Ёkhba_pad        Ё+6    Ё2     ЁW   ЁPad to DWORD mutiple.                   Ё
юддддддддддддддддаддддддаддддддаддддадддддддддддддддддддддддддддддддддддддддды
</PRE>
 
<P>
<B>krh_fl</B> flag definitions.
<PRE>зддддддддддддддбддддддддддбддддддддддддддддддддддддддддддддд©
ЁName          ЁBit Mask  ЁDescription                      Ё
цддддддддддддддеддддддддддеддддддддддддддддддддддддддддддддд╢
ЁPG_CONTIG     Ё0x00000001Ёcontiguous physical memory       Ё
цддддддддддддддеддддддддддеддддддддддддддддддддддддддддддддд╢
ЁPG_NOINCR     Ё0x00000001Ёdon't <!-- entering slot 3403 -->increment physical addrs   Ё
цддддддддддддддеддддддддддеддддддддддддддддддддддддддддддддд╢
ЁPG_W          Ё0x00000002ЁWritable - value from pte        Ё
цддддддддддддддеддддддддддеддддддддддддддддддддддддддддддддд╢
ЁPG_U          Ё0x00000004Ёuser mode accessible - from pte  Ё
цддддддддддддддеддддддддддеддддддддддддддддддддддддддддддддд╢
ЁPG_X          Ё0x00000008ЁeXecutable                       Ё
цддддддддддддддеддддддддддеддддддддддддддддддддддддддддддддд╢
ЁPG_R          Ё0x00000010ЁReadable                         Ё
цддддддддддддддеддддддддддеддддддддддддддддддддддддддддддддд╢
ЁPG_1M         Ё0x00000020Ёmust reside below 1 meg physical Ё
цддддддддддддддеддддддддддеддддддддддддддддддддддддддддддддд╢
ЁPG_GUARD      Ё0x00000040Ёguard page - from pte            Ё
цддддддддддддддеддддддддддеддддддддддддддддддддддддддддддддд╢
ЁPG_16M        Ё0x00000040Ёmust reside below 16 meg physicalЁ
цддддддддддддддеддддддддддеддддддддддддддддддддддддддддддддд╢
ЁPG_ZEROFILL   Ё0x00000080Ёzero initialize pages            Ё
цддддддддддддддеддддддддддеддддддддддддддддддддддддддддддддд╢
ЁPG_SWAPONWRITEЁ0x00000100Ёvalue from vp                    Ё
цддддддддддддддеддддддддддеддддддддддддддддддддддддддддддддд╢
ЁPG_UVIRT      Ё0x00000200Ёvalue from pte                   Ё
цддддддддддддддеддддддддддеддддддддддддддддддддддддддддддддд╢
ЁPG_RESIDENT   Ё0x00000400Ёvalue from pte                   Ё
цддддддддддддддеддддддддддеддддддддддддддддддддддддддддддддд╢
ЁPG_DISCARDABLEЁ0x00000800Ёvalue from vp                    Ё
юддддддддддддддаддддддддддаддддддддддддддддддддддддддддддддды
</PRE>
 

<P><HR>

<A HREF="3159_L3_KernelHeapHeaderStru.html">[Back: Kernel Heap Header Structure]</A> <BR>
<A HREF="3161_L3_KernelSwappableHeapS.html">[Next: Kernel Swappable Heap Structures]</A> 
</BODY>
</HTML>
