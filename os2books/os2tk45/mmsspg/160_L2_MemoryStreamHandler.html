<HTML>
<HEAD>
<META HTTP-EQUIV="CONTENT-TYPE" CONTENT="TEXT/HTML; CHARSET=UTF-8">
<TITLE>Memory Stream Handler</TITLE>
</HEAD>
<BODY>
<H1>Memory Stream Handler</H1><!-- entering slot 207 -->
<P>
There are many multimedia application scenarios where data streaming might
be performed to or from system memory.  For example, an application can
create a waveform data object dynamically, allocating application data buffers
in which to store the waveform data.  This data is not read from a device
but is generated by an application algorithm.  This waveform data can then
be streamed to the Waveform Audio Stream Handler (target).
<P>
Another example where system memory is used for streaming is when the application
must process or convert data read from a file before it can be used as the
source of a stream.  There can be some cases where application-unique data
compression is used.  In these cases, the application can stream data from
a "flat file" into an application buffer. Then, after decompression (or
other operation) this data in system memory can be streamed using the Memory
Stream Handler as the source, perhaps sending the data to the Waveform Audio
Stream Handler.
<P>
The Memory Stream Handler does not support synchronization.
<P>
Memory playlists are used to specify the memory addresses to play from or
record into.
<P>
<B>External Interface Description</B>
<P>
The description for the Memory Stream Handler external interface follows:
<!-- lm: 0x2 1 -->
<UL>
<P>
File Name<!-- lm: 0x2 21 -->
<UL> MEMSH.DLL<!-- lm: 0x2 1 -->
</UL> Handler
Name<!-- lm: 0x2 21 -->
<UL> MEMSH<!-- lm: 0x2 1 -->
</UL> Handler Class
<!-- lm: 0x2 21 -->
<UL>MEMSYS<!-- lm: 0x2 1 -->
</UL> PDD/DLL<!-- lm: 0x2 21 -->
<UL> DLL
<!-- lm: 0x2 1 -->
</UL>Source<!-- lm: 0x2 21 -->
<UL> This stream handler
<I>can</I> be the source in a stream.<!-- lm: 0x2 1 -->
</UL> Target<!-- lm: 0x2 21 -->
<UL> This
stream handler<I> can</I> be the target in a stream.<!-- lm: 0x2 1 -->
</UL>
<P>
<B>Device Control Blocks</B>
<P>
None.
<P>

<P>
<B>Associate Control Blocks</B>
<P>
This handler supports type ACBTYPE_MEM_PLAYL associate control blocks.
<PRE>/******************************************************
 * MEMSH - Memory Stream Handler Playlist Object ACB
 ******************************************************/
#define ACBTYPE_MEM_PLAYL     0x0003L  /* Memory playlist object     */

typedef struct _acb_mem_playl
   {
   ULONG   ulACBLen;              /* Length of structure             */
   ULONG   ulObjType;             /* ACBTYPE_MEM_PLAYL               */
   PVOID   pMemoryAddr;           /* Starting address of playlist    */
   } ACB_MEM_PLAYL;

</PRE>

<P>
<B>Implicit (EVENT_IMPLICIT_TYPE) Events Supported</B>
<P>
The following implicit (EVENT_IMPLICIT_TYPE) events for the Memory Stream
Handler are supported:<!-- lm: 0x2 3 -->
<UL>
<P>
<LI><!-- lm: 0x2 6 -->EVENT_ERROR
<P>
The error type will be set in the<I> ulFlag</I> field of the event implicit
control block (EVCB).  These error types and the flag values are described
in the file system stream handler section.
<P>
The<I> ulStatus</I> field will contain the error code.  The possible error
codes that can be generated and returned by this stream handler are:<!-- lm: 0x2 8 -->
<UL>
<P>
<LI><!-- lm: 0x2 11 -->ERROR_PLAYLIST_STACK_OVERFLOW (too many CALL instructions
encountered.  The maximum CALL depth is 20 calls.)<!-- lm: 0x2 8 -->
<BR>
<LI><!-- lm: 0x2 11 -->ERROR_PLAYLIST_STACK_UNDERFLOW (too many RETURN instructions
encountered.  There should be exactly one RETURN instruction executed for
each CALL instruction.)<!-- lm: 0x2 8 -->
<BR>
<LI><!-- lm: 0x2 11 -->ERROR_INVALID_FUNCTION (invalid playlist opcode encountered.)
<!-- lm: 0x2 8 -->
<BR>
<LI><!-- lm: 0x2 11 -->ERROR_INVALID_BLOCK (playlist is not read/write accessible
or data is not read (play) or write (record) accessible.)<!-- lm: 0x2 8 -->
<BR>
<LI><!-- lm: 0x2 11 -->ERROR_END_OF_PLAYLIST (when recording into a playlist,
the EXIT opcode was encountered before EOS.  The stream handler stops).
<!-- lm: 0x2 6 -->
</UL>Also, errors from the following APIs can be returned:
<!-- lm: 0x2 8 -->
<UL>
<P>
<LI><!-- lm: 0x2 11 -->DosGetInfoBlocks<!-- lm: 0x2 8 -->
<BR>
<LI><!-- lm: 0x2 11 -->DosQueryMem<!-- lm: 0x2 8 -->
<BR>
<LI><!-- lm: 0x2 11 -->SMHEntryPoint SMH_NOTIFY (GiveBuf function for Play)
<!-- lm: 0x2 8 -->
<BR>
<LI><!-- lm: 0x2 11 -->SMHEntryPoint SMH_NOTIFY (GetFull, ReturnEmpty for
Record)<!-- lm: 0x2 8 -->
<BR>
<LI><!-- lm: 0x2 11 -->SMHEntryPoint SMH_REPORTEVENT<!-- lm: 0x2 6 --><!-- lm: 0x2 3 -->
</UL> <!-- lm: 0x2 6 -->
<UL>EVENT_PLAYLISTCUEPOINT

<P>
The Memory Stream Handler does not receive playlist cuepoint<!-- entering slot 208 --> indicators
within the stream.  This handler will place a cuepoint indicator into a
stream when it interprets a CUEPOINT playlist operation.  Therefore this
stream handler does not generate the EVENT_PLAYLISTCUEPOINT, but it enables
it in the stream for the target stream handler.  Check the description of
the target stream handler to determine if it supports this EVENT_PLAYLISTCUEPOINT.
<!-- lm: 0x2 3 -->
</UL><!-- lm: 0x2 6 -->
<UL>EVENT_PLAYLISTMESSAGE
<P>
This is generated when a MESSAGE instruction is encountered.  The<I> ulMessageParm
</I>field of the PLAYL_EVCB will be filled in with the message supplied
in the message parameter (operand2) of the playlist MESSAGE instruction.
 The<I> ulStatus</I> field contains the playlist instruction number.<!-- lm: 0x2 1 -->
</UL>
<P>
<B>Explicit Events Supported</B>
<P>
No explicit events are supported for the Memory Stream Handler.
<P>
<B>Stream Handler Commands Supported</B>
<P>
The following stream handler commands (SHC) are supported.  Refer to the
<I>OS/2 Multimedia Programming Reference</I> for a description of these
SHC commands and the error return codes.<!-- lm: 0x2 3 -->
<UL>
<P>
<LI><!-- lm: 0x2 6 -->SHC_ASSOCIATE
<P>
<B>Note: </B> A stream requires a file to be opened and associated to the
stream before a stream can be started.  Reassociating a new object without
stopping the stream is not supported.<!-- lm: 0x2 6 -->
<UL>
<P>
Possible return codes:<!-- lm: 0x2 8 -->
<UL>
<P>
<LI><!-- lm: 0x2 11 -->ERROR_INVALID_STREAM (invalid<I> hstream</I> or<I> hstream
</I>and<I> hid</I> passed)<!-- lm: 0x2 8 --> -<!-- lm: 0x2 11 -->
<UL>ERROR_INVALID_OBJTYPE
(only ACBTYPE_MEM_PLAYL is supported)<!-- lm: 0x2 8 -->
</UL>-<!-- lm: 0x2 11 -->
<UL>ERROR_INVALID_BUFFER_SIZE (<I>ulAcbLen</I> is
smaller than needed)<!-- lm: 0x2 8 -->
</UL>-<!-- lm: 0x2 11 -->
<UL>ERROR_STREAM_NOT_STOP (stream must be stopped
to associate)<!-- lm: 0x2 8 -->
</UL>-<!-- lm: 0x2 11 -->
<UL>ERROR_INVALID_BLOCK (invalid memory address
- not read/write accessible)<!-- lm: 0x2 6 -->
</UL> Return codes from the
following APIs are also returned:<!-- lm: 0x2 8 -->
<UL>
<P>
<LI><!-- lm: 0x2 11 -->DosRequestMutexSem<!-- lm: 0x2 8 --> -<!-- lm: 0x2 11 -->
<UL>DosQueryMem
<!-- lm: 0x2 6 -->
</UL><!-- lm: 0x2 3 -->
</UL><!-- lm: 0x2 6 -->
<UL>SHC_CREATE

<P>
<B>Note: </B> If the<I> SPCBKEY</I> passed does not match any of the installed
protocols, the last installed SPCB with DATATYPE_GENERIC will be used.  If
the MEMSH is the source, create will always set the SPCBBUF_USERPROVIDED
flag in the spcb.ulBufFlag field.<!-- lm: 0x2 6 -->
<P>
Possible return codes:<!-- lm: 0x2 8 -->
<UL>
<P>
<LI><!-- lm: 0x2 11 -->ERROR_INVALID_SPCBKEY<!-- lm: 0x2 8 -->
<BR>
<LI><!-- lm: 0x2 11 -->ERROR_ALLOC_RESOURCES<!-- lm: 0x2 6 -->
</UL> Return
codes from the following APIs are also returned:<!-- lm: 0x2 8 -->
<UL>
<P>
<LI><!-- lm: 0x2 11 -->DosRequestMutexSem<!-- lm: 0x2 8 -->
<BR>
<LI><!-- lm: 0x2 11 -->DosCreateThread<!-- lm: 0x2 6 --><!-- lm: 0x2 3 -->
</UL> <!-- lm: 0x2 6 -->
<UL>SHC_DESTROY

<P>
Possible return codes:<!-- lm: 0x2 8 -->
<UL>
<P>
<LI><!-- lm: 0x2 11 -->ERROR_INVALID_STREAM (invalid<I> hstream</I> or<I> hstream
</I>and<I> hid</I> passed)<!-- lm: 0x2 6 -->
</UL> Return codes from the
following APIs are also returned:<!-- lm: 0x2 8 -->
<UL>
<P>
<LI><!-- lm: 0x2 11 -->DosRequestMutexSem<!-- lm: 0x2 6 --><!-- lm: 0x2 3 -->
</UL> <!-- lm: 0x2 6 -->
<UL>SHC_START

<P>
Possible return codes:<!-- lm: 0x2 8 -->
<UL>
<P>
<LI><!-- lm: 0x2 11 -->ERROR_INVALID_STREAM (invalid<I> hstream</I> or<I> hid</I>-or
both-passed)<!-- lm: 0x2 8 -->
<BR>
<LI><!-- lm: 0x2 11 -->ERROR_DATA_ITEM_NOT_SPECIFIED (stream must be associated
before it is started).<!-- lm: 0x2 6 -->
</UL> Return codes from the following
APIs are also returned:<!-- lm: 0x2 8 -->
<UL>
<P>
<LI><!-- lm: 0x2 11 -->DosRequestMutexSem<!-- lm: 0x2 6 --><!-- lm: 0x2 3 -->
</UL> <!-- lm: 0x2 6 -->
<UL>SHC_STOP

<P>
Possible return codes:<!-- lm: 0x2 8 -->
<UL>
<P>
<LI><!-- lm: 0x2 11 -->ERROR_INVALID_STREAM (invalid<I> hstream</I> or<I> hid</I>-or
both-passed)<!-- lm: 0x2 8 -->
<BR>
<LI><!-- lm: 0x2 11 -->ERROR_STREAM_NOT_STARTED<!-- lm: 0x2 6 -->
</UL> Return
codes from the following APIs are also returned:<!-- lm: 0x2 8 -->
<UL>
<P>
<LI><!-- lm: 0x2 11 -->DosRequestMutexSem<!-- lm: 0x2 8 -->
<BR>
<LI><!-- lm: 0x2 11 -->DosResumeThread<!-- lm: 0x2 8 -->
<BR>
<LI><!-- lm: 0x2 11 -->DosSuspendThread<!-- lm: 0x2 6 -->
</UL><!-- lm: 0x2 3 -->
</UL> <!-- lm: 0x2 6 -->
<UL>SHC_SEEK

<P>
<B>Note: </B> Seeking backward is not supported.  SEEK_END is only supported
if the<I> lSeekPoint</I> is 0.  A playlist seek is accomplished by going
back to the beginning of the playlist and executing each instruction without
playing the data, but counting the time it takes.  The Seek operates on
the current playlist, that means that if the playlist was modified by the
application the Seek uses the modified playlist to calculate the seek position.
 When a seek absolute is performed all LOOP iterations are reset to 0 before
the Seek starts calculating the position.<!-- lm: 0x2 6 -->
<P>
Possible return codes:<!-- lm: 0x2 8 -->
<UL>
<P>
<LI><!-- lm: 0x2 11 -->ERROR_INVALID_STREAM (invalid<I> hstream</I> or<I> hid</I>-or
both-passed)<!-- lm: 0x2 8 -->
<BR>
<LI><!-- lm: 0x2 11 -->ERROR_NOT_SEEKABLE_BY_TIME<!-- lm: 0x2 8 -->
<BR>
<LI><!-- lm: 0x2 11 -->ERROR_DATA_ITEM_NOT_SEEKABLE<!-- lm: 0x2 8 -->
<BR>
<LI><!-- lm: 0x2 11 -->ERROR_STREAM_NOT_STOP<!-- lm: 0x2 8 -->
<BR>
<LI><!-- lm: 0x2 11 -->ERROR_SEEK_BACK_NOT_SUPPORTED<!-- lm: 0x2 8 -->
<BR>
<LI><!-- lm: 0x2 11 -->ERROR_SEEK_PAST_END<!-- lm: 0x2 8 -->
<BR>
<LI><!-- lm: 0x2 11 -->ERROR_INVALID_BLOCK<!-- lm: 0x2 8 -->
<BR>
<LI><!-- lm: 0x2 11 -->ERROR_PLAYLIST_STACK_OVERFLOW<!-- lm: 0x2 8 -->
<BR>
<LI><!-- lm: 0x2 11 -->ERROR_PLAYLIST_STACK_UNDERFLOW<!-- lm: 0x2 8 -->
<BR>
<LI><!-- lm: 0x2 11 -->ERROR_INVALID_FUNCTION<!-- lm: 0x2 8 -->
<BR>
<LI><!-- lm: 0x2 11 -->ERROR_DATA_ITEM_NOT_SPECIFIED<!-- lm: 0x2 6 -->
</UL> Return
codes from the following APIs are also returned:<!-- lm: 0x2 8 -->
<UL>
<P>
<LI><!-- lm: 0x2 11 -->DosRequestMutexSem<!-- lm: 0x2 8 -->
<BR>
<LI><!-- lm: 0x2 11 -->DosQueryMem<!-- lm: 0x2 6 --><!-- lm: 0x2 3 -->
</UL> <!-- lm: 0x2 6 -->
<UL>SHC_GET_PROTOCOL

<P>
Possible return codes:<!-- lm: 0x2 8 -->
<UL>
<P>
<LI><!-- lm: 0x2 11 -->ERROR_INVALID_SPCBKEY<!-- lm: 0x2 6 -->
</UL> Return
codes from the following APIs are also returned:<!-- lm: 0x2 8 -->
<UL>
<P>
<LI><!-- lm: 0x2 11 -->DosRequestMutexSem<!-- lm: 0x2 6 --><!-- lm: 0x2 3 -->
</UL> <!-- lm: 0x2 6 -->
<UL>SHC_INSTALL_PROTOCOL

<P>
<B>Note: </B> This stream handler allows any data type and subtype to be
installed.<!-- lm: 0x2 6 -->
<P>
Possible return codes:<!-- lm: 0x2 8 -->
<UL>
<P>
<LI><!-- lm: 0x2 11 -->ERROR_INVALID_SPCBKEY<!-- lm: 0x2 8 -->
<BR>
<LI><!-- lm: 0x2 11 -->ERROR_ALLOC_RESOURCES<!-- lm: 0x2 6 -->
</UL> Return
codes from the following APIs are also returned:<!-- lm: 0x2 8 -->
<UL>
<P>
<LI><!-- lm: 0x2 11 -->DosRequestMutexSem<!-- lm: 0x2 6 --><!-- lm: 0x2 3 -->
</UL> <!-- lm: 0x2 6 -->
<UL>SHC_ENUMERATE_PROTOCOLS

<P>
Possible return codes:<!-- lm: 0x2 8 -->
<UL>
<P>
<LI><!-- lm: 0x2 11 -->ERROR_INSUFF_BUFFER<!-- lm: 0x2 6 -->
</UL> Return
codes from the following APIs are also returned:<!-- lm: 0x2 8 -->
<UL>
<P>
<LI><!-- lm: 0x2 11 -->DosRequestMutexSem<!-- lm: 0x2 6 --><!-- lm: 0x2 3 -->
</UL> <!-- lm: 0x2 6 -->
<UL>SHC_NEGOTIATE_RESULT

<P>
Possible return codes:<!-- lm: 0x2 8 -->
<UL>
<P>
<LI><!-- lm: 0x2 11 -->ERROR_INVALID_STREAM (invalid<I> hstream</I> or<I> hid</I>-or
both-passed)<!-- lm: 0x2 8 -->
<BR>
<LI><!-- lm: 0x2 11 -->ERROR_INVALID_FUNCTION (must only be called directly
after create)<!-- lm: 0x2 6 -->
</UL> Return codes from the following APIs
are also returned:<!-- lm: 0x2 8 -->
<UL>
<P>
<LI><!-- lm: 0x2 11 -->DosRequestMutexSem<!-- lm: 0x2 6 --><!-- lm: 0x2 1 -->
</UL>
<P>
<B>Base Stream<!-- entering slot 209 --> Protocol Control Block Data Types
Supported</B>
<P>
The Memory Stream Handler has only 1 base stream protocol control block
(SPCB).  It is DATATYPE_GENERIC.  When a stream is created with a<I> SPCBKEY
</I>that is not one installed, this stream handler copies over the last
installed SPCB of type DATATYPE_GENERIC and uses it.  The data type, subtype
and<I> intkey</I> passed are used in place of the generic values for these
fields.  The base generic SPCB has:
<PRE>┌───────────────┬─────────────────────────────────────────────┐│SPCB Field     │DATATYPE_GENERIC Values                      │
├───────────────┼─────────────────────────────────────────────┤
│ulBufSize      │16KB                                         │
├───────────────┼─────────────────────────────────────────────┤
│ulMinBuf       │3                                            │
├───────────────┼─────────────────────────────────────────────┤
│ulMaxBuf       │10                                           │
├───────────────┼─────────────────────────────────────────────┤
│ulSrcStart     │1                                            │
├───────────────┼─────────────────────────────────────────────┤
│ulTgtStart     │1                                            │
├───────────────┼─────────────────────────────────────────────┤
│ulBufFlag      │SPCBBUF_NONCONTIGUOUS                        │
├───────────────┼─────────────────────────────────────────────┤
│ulHandFlag     │SPCBHAND_NOSYNC | SPCBHAND_PHYS_SEEK         │
└───────────────┴─────────────────────────────────────────────┘
</PRE>

<P>
<B>Stream Handler Limits</B>
<P>
Maximum number of streams (only limited by available memory).
<P>


<P><HR>

<A HREF="159_L2_FileSystemStreamHand.html">[Back: File System Stream Handler]</A> <BR>
<A HREF="161_L2_CompactDiscDigitalAu.html">[Next: Compact Disc-Digital Audio Stream Handler]</A> 
</BODY>
</HTML>
