<HTML>
<HEAD>
<META HTTP-EQUIV="CONTENT-TYPE" CONTENT="TEXT/HTML; CHARSET=UTF-8">
<TITLE>Generating binding files</TITLE>
<STYLE>
PRE {
  FONT-FAMILY: Consolas, "Lucida Console", "Courier New", Courier, MONOSPACE;
}
</STYLE>
</HEAD>
<BODY>
<H1>Generating binding files</H1><!-- entering slot 137 -->
<P>
The SOM Compiler operates in two phases:<!-- lm: 0x2 3 -->
<UL>
<P>
<LI><!-- lm: 0x2 6 -->A precompile phase, in which a precompiler analyzes
an OIDL or IDL class definition, and<!-- lm: 0x2 3 -->
<P>
<LI><!-- lm: 0x2 6 -->An emission phase, in which one or more  emitter programs
produce  binding files.<!-- lm: 0x2 1 -->
</UL>
<P>
Each binding file is generated by a separate emitter program. Setting the
SMEMIT environment variable determines which emitters will be used, as described
below. Note: In the discussion below, the &lt;filesystem&gt; is determined
by default from the name of the source .idl file with the ".idl" extension
removed. Otherwise, a "filestem" modifier can be defined in the .idl file
to specify another file name (see "Modifier statements" above).
<P>
Note: If changes to definitions in the .idl file later become necessary,
the SOM Compiler should be rerun to update the current implementation template
file, provided that the<B> c</B> or<B> xc</B> emitter is specified (either
with the -s option or the SMEMIT environment variable, as described below).
For more information on generating updates, see "Running incremental updates
of the implementation template file" later in this chapter.
<P>
The emitters for the C language produce the following binding files:<!-- lm: 0x2 1 -->
<P>
&lt;<I>filestem</I>&gt;<B>.c</B><!-- lm: 0x2 26 -->
<UL> (produced by the
<B>c</B> emitter)
<P>
This is a template for a C source program that implements a class's methods.
This will become the primary source file for the class. (The other binding
files can be generated from the<B> .idl</B> file as needed.) This template
implementation file contains "stub" procedures for each method introduced
or overridden by the class. (The stub procedures are empty of code except
for required initialization and debugging statements.)
<P>
After the class implementer has supplied the code for the method procedures,
running the<B> c</B> emitter again will update the implementation file to
reflect changes made to the class definition (in the<B> .idl</B> file).
These updates include adding new stub procedures, adding comments, and changing
method prototypes to reflect changes made to the method definitions in the
IDL specification. Existing code within method procedures is not disturbed,
however.
<P>
The<B> .c</B> file contains an<B> #include</B> directive for the<B> .ih
</B>file, described below.
<P>
The contents of the C source template is controlled by the Emitter Framework
file &lt;SOMBASE&gt;/include/ctm.efw. This file can be customized to change
the template produced. For detailed information on changing the template
file see the<I> Emitter Framework Guide and Reference</I>.<!-- lm: 0x2 1 -->
</UL> &lt;<I>filestem</I>&gt;<B>.h
</B><!-- lm: 0x2 26 -->
<UL>(produced by the<B> h</B> emitter)
<P>
This is the header file to be included by C client programs (programs that
use the class). It contains the C usage bindings for the class, including
macros for accessing the class's methods and a macro for creating new instances
of the class. This header file includes the header files for the class's
parent classes and its metaclass, as well as the header file that defines
SOM's generic C bindings,<B> som.h.</B><!-- lm: 0x2 1 -->
</UL> &lt;<I>filestem</I>&gt;<B>.ih
</B><!-- lm: 0x2 26 -->
<UL>(produced by the<B> ih</B> emitter)
<P>
This is the header file to be included in the implementation file (the file
that implements the class's methods-the .c file). It contains the implementation
bindings for the class, including:<!-- lm: 0x2 28 -->
<UL>
<P>
<LI><!-- lm: 0x2 31 -->a<B> struct</B> defining the class's instance variables,
<!-- lm: 0x2 28 --><!-- lm: 0x2 31 -->
<UL>macros for accessing instance
variables,<!-- lm: 0x2 28 -->
</UL><!-- lm: 0x2 31 -->
<UL>macros for invoking parent methods the class
overrides,<!-- lm: 0x2 28 -->
</UL><!-- lm: 0x2 31 -->
<UL>the &lt;<I>className</I>&gt;<B>GetData</B>
macro used by the method procedures in the &lt;<I>filestem</I>&gt;<B>.c
</B>file (see "Stub procedures for methods" in Section 5.4 of Chapter 5.)
<!-- lm: 0x2 28 -->
</UL><!-- lm: 0x2 31 -->
<UL>a &lt;<I>className</I>&gt;<B>NewClass</B> procedure
for constructing the class object at run time, and<!-- lm: 0x2 28 -->
</UL><!-- lm: 0x2 31 -->
<UL>any IDL types and constants defined in the
IDL interface.<!-- lm: 0x2 26 --><!-- lm: 0x2 1 -->
</UL>
<P>
<U><I>The emitters for the C++ language</I></U> produce the following binding
files:<!-- lm: 0x2 1 -->
<P>
&lt;<I>filestem</I>&gt;.C (for AIX) or  &lt;<I>filestem</I>&gt;.cpp (for
OS/2)<!-- lm: 0x12 26 -->
<UL> (produced by the<B> xc</B> emitter)
<P>
This is a template for a C++ source program that implements a class's methods.
This will become the primary source file for the class. (The other binding
files can be generated from the<B> .idl</B> file as needed.)  This template
implementation file contains "stub" procedures for each method introduced
or overridden by the class. (The stub procedures are empty of code except
for required initialization and debugging statements.)
<P>
After the class implementer has supplied the code for the method procedures,
running the<B> xc</B> emitter again will update this file to reflect changes
made to the class definition (in the<B> .idl</B> file). These updates include
adding new stub procedures, adding comments, and changing method prototypes
to reflect changes made to the method definitions in the IDL specification.
Existing code within method procedures is not disturbed, however.
<P>
The C++ implementation file contains an<B> #include</B> directive for the
<B>.xih</B> file, described below.
<P>
The contents of the C++ source template is controlled by the Emitter Framework
file &lt;SOMBASE&gt;/include/ctm.efw. This file can be customized to change
the template produced. For detailed information on changing the template
file see the<I> Emitter Framework Guide and Reference</I>.<!-- lm: 0x2 1 -->
</UL> &lt;<I>filestem</I>&gt;<B>.xh
</B><!-- lm: 0x12 26 -->
<UL>(produced by the<B> xh</B> emitter)
<P>
This is the header file to be included by C++ client programs that use the
class. It contains the usage bindings for the class, including a C++ definition
of the class, macros for accessing the class's methods, and the<B> new</B> operator
for creating new instances of the class. This header file includes the header
files for the class's parent classes and its metaclass, as well as the header
file that defines SOM's generic C++ bindings,<B> som.xh</B>.<!-- lm: 0x2 1 -->
</UL> &lt;<I>filestem</I>&gt;<B>.xih
</B><!-- lm: 0x12 26 -->
<UL>(produced by the<B> xih</B> emitter)
<P>
This is the header file to be included in the implementation file (the file
that implements the class's methods). It contains the implementation bindings
for the class, including:<!-- lm: 0x2 28 -->
<UL>
<P>
<LI><!-- lm: 0x2 31 -->a<B> struct</B> defining the class's instance variables,
<!-- lm: 0x2 28 --><!-- lm: 0x2 31 -->
<UL>macros for accessing instance
variables,<!-- lm: 0x2 28 -->
</UL><!-- lm: 0x2 31 -->
<UL>macros for invoking parent methods the class
overrides,<!-- lm: 0x2 28 -->
</UL><!-- lm: 0x2 31 -->
<UL>the &lt;<I>className</I>&gt;<B>GetData</B>
macro (see section 5.4),<!-- lm: 0x2 28 -->
</UL><!-- lm: 0x2 31 -->
<UL>a &lt;<I>className</I>&gt;<B>NewClass</B> procedure
for constructing the class object at run time, and<!-- lm: 0x2 28 -->
</UL><!-- lm: 0x2 31 -->
<UL>any IDL types and constants defined in the
IDL interface.<!-- lm: 0x2 26 --><!-- lm: 0x2 1 -->
</UL>
<P>
<U><I>Other files the SOM Compiler generates:</I></U><!-- lm: 0x2 1 -->
<P>
&lt;<I>filestem</I>&gt;<B>.hh</B><!-- lm: 0x12 26 -->
<UL> (produced by
the<B> hh</B> emitter)
<P>
This file is a DirectToSOM C++ header file that describes a SOMobjects class
in a way appropriate to DTS C++. When running this emitter, you<!-- entering slot 138 --> must
include the<B> noqualitytypes</B> command-line modifier for the<B> -m</B> optionof
the SOM Compiler command<B> sc</B> or<B> somc.</B><!-- lm: 0x2 1 -->
</UL> &lt;<I>filestem</I>&gt;<B>pdl
</B><!-- lm: 0x12 26 -->
<UL>(produced by the<B> pdl</B> emitter) This file
is the same as the .idl file from which it is produced except that all items
within the .idl file that are marked as "private" have been removed.  (an
item is marked as private by surrounding it with "#ifdef_PRIVATE_" and "#endif"
directives.  Thus, the<B> pdl</B> (Public Definition Lnguage) emitter can
be used to generate a "public" version of the .idl file.<!-- lm: 0x2 1 -->
</UL> &lt;<I>filestem</I>&gt;.def
(for OS/2)<!-- lm: 0x12 26 -->
<UL> (produced by the<B> def</B> emitter)

<P>
This file is used by the linker to package a class as a library. To combine
several classes into a single library, you must merge the<B> exports</B> statements
from each of their<B> .def</B>  files into a single<B> .def</B> file for
the entire library. When packaging multiple classes in a single library,
you must also write a simple C procedure named<B> SOMInitModule</B> and
add it to the export list. This procedure should call the routine &lt;<I>className</I>&gt;<B>NewClass
</B>for each class packaged in the library. The<B> SOMInitModule</B> procedure
is called by the SOM Class Manager when the library is dynamically loaded.
<!-- lm: 0x2 1 -->
</UL>&lt;<I>filestem</I>&gt;.exp  (for AIX)<!-- lm: 0x12 26 -->
<UL> (produced
by the<B> exp</B> emitter)
<P>
This file is used by the linker to package a class as a library. To combine
several classes into a single library, you must merge the<B> exports</B> statements
from each of their<B> .exp</B>  files into a single<B> .exp</B> file for
the entire library. When packaging multiple classes in a single library,
you must also write a simple C procedure named<B> SOMInitModule</B> and
add it to the export list. This procedure should call the routine &lt;<I>className</I>&gt;<B>NewClass
</B>for each class packaged in the library The<B> SOMInitModule</B> procedure
is called by the SOM Class Manager when the library is dynamically loaded.
<!-- lm: 0x2 1 -->
</UL>The Interface Repository<!-- lm: 0x12 26 -->
<UL> (produced
by the<B> ir</B> emitter)
<P>
See Chapter 7 for a discussion on the Interface Repository.<!-- lm: 0x2 1 -->
</UL>Note: The C/C++ bindings generated by the SOM Compiler have the following
limitation: If two classes named "ClassName" and "ClassNameC" are defined,
the bindings for these two classes will clash. That is, if a client program
uses the C/C++ bindings (includes the .h/.xh header file) for both classes,
a name conflict will occur. Thus, class implementers should keep this limitation
in mind when naming their classes.
<P>
SOM users can extend the SOM Compiler to generate additional files by writing
their own emitters. To assist users in extending the SOM Compiler, SOM provides
an Emitter Framework a collection of classes and methods useful for writing
object-oriented emitters that the SOM Compiler can invoke. For more information,
see the<I> Emitter Framework Guide and Reference</I>.
<P>
<B>Note re:  porting SOM classes</B>: The header files (binding files) that
the SOM Compiler generates will only work on the platform (operating system)
on which they were generated. Thus, when porting SOM classes from the platform
where they were developed to another platform, the header files must be
regenerated from the .idl file by the SOM Compiler on that target platform.


<P><HR>

<A HREF="113_L2_TheSOMCompiler.html">[Back: The SOM Compiler]</A> <BR>
<A HREF="115_L3_Environmentvariables.html">[Next: Environment variables affecting the SOM Compiler]</A> 
</BODY>
</HTML>
