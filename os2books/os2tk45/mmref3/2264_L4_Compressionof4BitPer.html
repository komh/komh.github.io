<HTML>
<HEAD>
<META HTTP-EQUIV="CONTENT-TYPE" CONTENT="TEXT/HTML; CHARSET=UTF-8">
<TITLE>Compression of 4-Bit-Per-Pixel DIBs</TITLE>
<STYLE>
PRE {
  FONT-FAMILY: Consolas, "Lucida Console", "Courier New", Courier, MONOSPACE;
}
</STYLE>
</HEAD>
<BODY>
<H1>Compression of 4-Bit-Per-Pixel DIBs</H1><!-- entering slot 2267 -->
<P>
When the field is set to BI_RLE4, the bitmap is compressed using a run-length
encoding format for a 4-bit bitmap. This format uses two modes:<!-- lm: 0x2 3 -->
<UL>
<P>
<LI><!-- lm: 0x2 6 -->Encoded mode<!-- lm: 0x2 3 -->
<BR>
<LI><!-- lm: 0x2 6 -->Absolute mode<!-- lm: 0x2 1 -->
</UL>
<P>
<B>Encoded Mode</B> In encoded mode, the first byte of the pair contains
the number of pixels to be drawn using the color indexes in the second byte.

<P>
The second byte contains two color indexes, one in its high-order nibble
(that is, its high-order four bits) and one in its low-order nibble.
<P>
The first of the pixels is drawn using the color specified by the high-order
nibble; the second, using the color in the low-order nibble; the third,
with the color in the high-order nibble; and so on, until all the pixels
specified by the first byte have been drawn.
<P>
Also, the first byte of the pair can be set to 0 to indicate an escape that
denotes an end of line, end of bitmap, or a delta. The interpretation of
the escape depends on the value of the second byte of the pair. In encoded
mode, the second byte has a value from 00H to 02H.
<P>
<B>Absolute Mode</B>
<BR>
In absolute mode, the first byte contains 0, the second byte contains the
number of color indexes that follow, and subsequent bytes contain color
indexes in their high- and low-order nibbles, one color index for each pixel.

<P>
Each run must be aligned on a word boundary.
<P>
The end-of-line, end-of-bitmap, and delta escapes valid for BI_RLE8 also
apply to BI_RLE4.
<P>
The following example shows the hexadecimal values of a 4-bit RLE bitmap.
Under<B> Expanded Data</B>, the 1-digit values represent a color index for
a single pixel.
<PRE>┌──────────────────────────────┬──────────────────────────────┐
│Compressed Data               │Expanded Data                 │
├──────────────────────────────┼──────────────────────────────┤
│03 04                         │0 4 0                         │
│05 06                         │0 6 0 6 0                     │
│00 06 45 56 67 00             │4 5 5 6 6 7                   │
│04 78                         │7 8 7 8                       │
│00 02 05 01                   │move 5 right and 1 down       │
│04 78                         │7 8 7 8                       │
│00 00                         │end of line                   │
│09 1E                         │1 E 1 E 1 E 1 E 1             │
│00 01                         │end of RLE bitmap             │
└──────────────────────────────┴──────────────────────────────┘
</PRE>


<P><HR>

<A HREF="2263_L4_Compressionof8BitPer.html">[Back: Compression of 8-Bit-Per-Pixel DIBs]</A> <BR>
<A HREF="2265_L2_RIFFDeviceIndependen.html">[Next: RIFF Device-Independent Bitmap File Format]</A> 
</BODY>
</HTML>
