<HTML>
<HEAD>
<META HTTP-EQUIV="CONTENT-TYPE" CONTENT="TEXT/HTML; CHARSET=UTF-8">
<TITLE>Messages</TITLE>
</HEAD>
<BODY>
<H1>Messages</H1><!-- entering slot 196 -->
<P>
Messages are the mechanism by which windows communicate with one another
and are notified of system- or user-initiated events by Presentation Manager.
 In a typical Presentation Manager application, all interaction between
the user and windows, or between one window and another, takes place by
way of messages.  Messages may be of three types:<!-- lm: 0x2 0 -->
<P>
<B>User-initiated</B><!-- lm: 0x2 27 -->
<UL> The message is generated as
the direct result of the user selecting a menu bar item, pressing a key
on the keyboard, etc.<!-- lm: 0x2 0 -->
</UL><B> Application-initiated</B><!-- lm: 0x2 27 -->
<UL> The
message is generated by one window within the application for the communication
of an event to another window.<!-- lm: 0x2 0 -->
</UL><B> System-initiated
</B><!-- lm: 0x2 27 -->
<UL>The message is generated by Presentation Manager
as the indirect result of user action such as the window being re-sized
or moved, or as the result of a system event such as window being created
or destroyed.<!-- lm: 0x2 0 -->
</UL>
<P>
Since almost every event which occurs within the system results in a message
being generated, a Presentation Manager application has great freedom in
the way in which it processes such events.
<P>
<B>Message Queues</B>
<P>
Whenever an event occurs within the system, such as the user pressing a
key or selecting an item from a menu, a window being created or destroyed,
or one window communicating with another, a message is generated and placed
on a system message queue. Such messages are placed on the queue in the
order they originated.
<P>
Each application has its own message queue, and each thread within a multi-threaded
application may also possess its own message queue. This queue is explicitly
created by the thread, via a function call to Presentation Manager, at the
time the thread is initialized. (The term "thread" will be used herein,
since message queues are always created on a per-thread basis; the application's
initial message queue is created by its primary thread.)
<P>
Note that a secondary thread in a multi-threaded application need only create
a message queue if it will create one or more windows.  A secondary thread
which does not create windows does not require a message queue.
<P>
<A HREF="044_L2_MessageQueues.html">Figure "Message Queues"</A>
<P>
Presentation Manager periodically interrogates the system queue, removes
each message and determines the window for which it is destined.  It then
places the message on the message queue belonging to the thread which created
the window.
<P>
The thread's main routine, once initialization is complete, consists entirely
of a message processing loop.  The thread simply retrieves a message from
the message queue via a function call to Presentation Manager, and requests
Presentation Manager to pass the message to the appropriate window procedure,
which is already known to Presentation Manager through the window class
definition.
<P>
Presentation Manager then invokes the window procedure to process the message.
 When the processing is complete, the window procedure passes control back
to Presentation Manager, which then returns control to the thread's main
routine to obtain the next message.
<P>
If the thread's own message queue is empty when it requests the next message,
Presentation Manager checks the system queue. <I> Note that this is the
only time at which the system queue is accessed; hence no other window in
the system can receive a message until the currently executing window procedure
returns control to Presentation Manager</I>.
<P>
If a window procedure does not return from processing a message within a
reasonable period of time, the user is effectively "locked out" of the system.
 In order to avoid such situations, applications which perform lengthy operations
such as document formatting or remote system access, should be implemented
using multiple threads, thereby allowing the application's primary thread
to continue execution and return control to Presentation Manager.  This
technique is discussed in<I> OS/2 Version 2.0 - Volume 4:  Application Development</I>.

<P>
<B>Message Classes</B>
<P>
Messages are defined and identified using message classes.  A message class
is simply an integer used to identify the event which caused the message.

<P>
Message classes may be of two types:<!-- lm: 0x2 0 -->
<P>
<LI><!-- lm: 0x2 2 --><I>System-defined</I> message classes are defined
by Presentation Manager, and are used to indicate standard events such as
a window being created or destroyed, sized or moved, or a key being pressed.
<!-- lm: 0x2 0 -->
<P>
<LI><!-- lm: 0x2 2 --><I>Application-defined</I> message classes are defined
by an individual application, and are used to indicate events for communication
between windows in that application.<!-- lm: 0x2 0 -->
<P>
Message classes are usually defined as integer<!-- entering slot 197 --> constants.
 All system-defined message classes are defined in the header files which
are shipped with the<I> IBM Developer's Toolkit for OS/2 2.0</I>.  Application-defined
message classes are usually defined in the application's own header files.

<P>
The structure of a message also includes two message parameters, which are
32-bit fields passed to the window procedure along with the message.  These
fields may contain additional information to aid in the window procedure's
processing, or may contain pointers to memory objects which in turn contain
such information.
<P>
<B>Message Processing</B>
<P>
Through its window procedures, a Presentation Manager application has the
ability to process messages of any type or class, in the following ways:
<!-- lm: 0x2 0 -->
<P>
<LI><!-- lm: 0x2 2 -->The window procedure may ignore the message, and simply
leave it for Presentation Manager's own default window procedure, which
will provide default processing for system-defined messages classes.<!-- lm: 0x2 0 -->
<P>
<LI><!-- lm: 0x2 2 -->The window procedure may explicitly process the message,
using its own logic, calling subroutines and/or passing messages to other
windows as necessary.  This allows processing of application-defined message
classes, and application-specific, "non-standard" processing of system-defined
message classes.<!-- lm: 0x2 0 -->
<P>
<LI><!-- lm: 0x2 2 -->The window procedure may explicitly process the message
and then pass the message on to Presentation Manager's default window procedure.
 This allows application-specific processing to be performed on system-defined
message classes, in addition to the default processing.<!-- lm: 0x2 0 -->
<BR>

<P>
Messages may also be processed in either of two modes:<!-- lm: 0x2 0 -->
<P>
<LI><!-- lm: 0x2 2 --><I>Synchronous</I> processing occurs where the routine
which passes the message (typically a window procedure or a subroutine invoked
by a window procedure) waits until the message is passed to the target window
and processed by its window procedure.  Presentation Manager does not return
control to the calling routine until the window procedure has completed
its processing.<!-- lm: 0x2 0 -->
<P>
<LI><!-- lm: 0x2 2 --><I>Asynchronous</I> processing occurs where the routine
which passes the message waits only until the message is placed in the thread's
message queue.  Presentation Manager then returns control to the calling
routine.<!-- lm: 0x2 0 -->
<BR>

<P>
Presentation Manager also provides facilities which allow an application
to broadcast messages to multiple windows with a single function call.

<P><HR>

<A HREF="183_L3_Windows.html">[Back: Windows]</A> <BR>
<A HREF="185_L3_PresentationSpacesan.html">[Next: Presentation Spaces and Device Contexts]</A> 
</BODY>
</HTML>
