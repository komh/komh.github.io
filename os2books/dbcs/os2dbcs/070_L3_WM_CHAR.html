<HTML>
<HEAD>
<META HTTP-EQUIV="CONTENT-TYPE" CONTENT="TEXT/HTML; CHARSET=UTF-8">
<TITLE>WM_CHAR</TITLE>
<STYLE>
PRE {
  FONT-FAMILY: Consolas, "Lucida Console", "Courier New", Courier, MONOSPACE;
}
</STYLE>
</HEAD>
<BODY>
<H1>WM_CHAR</H1><!-- entering slot 75 -->
<P>
When the message queue code page is set to a combined code page, a<B> WM_CHAR
</B>message conveys either an SBCS character or a DBCS character depending
on what the user typed in. When the current character is an SBCS character,
CHAR1FROMMP contains its character code and CHAR2FROMMP contains NULL. When
the current character is a DBCS character, CHAR1FROMMP contains the first
byte of its character code and CHAR2FROMMP contains the second byte.
<PRE>┌───────────────────┬────────────────┬────────────────┐
│ Current Character │ CHAR1FROMMP    │ CHAR2FROMMP    │
├───────────────────┼────────────────┼────────────────┤
│ An SBCS           │ Character code │ NULL           │
├───────────────────┼────────────────┼────────────────┤
│ A DBCS            │ First byte     │ Second byte    │
└───────────────────┴────────────────┴────────────────┘
WM_CHAR
</PRE>

<P>
The following is the structure of a code fragment which can correctly handle
WM_CHAR messages containing both SBCS and DBCS characters.
<PRE>case WM_CHAR:
    fs = SHORT1FROMMP(mp1);
    ...
    if (!(fs &amp; KC_KEYUP))
    {
      if (fs &amp; KC_CHAR)
      {
        if(CHAR2FROMMP(mp2) != NULL)
        {
          /* WM_CHAR conveys a double-byte character */
        ...
        }
        else
        {
          /* WM_CHAR conveys a single-byte character */
        ...
        }
      }
      else if (fs &amp; KC_VIRTUALKEY)
      {
        /* processing virtual keys */
        ...
      }
    ...
    }
    break;
</PRE>

<P>
Another point you have to consider in handling<B> WM_CHAR</B> is that it
does not carry a scan code for the characters generated by the input method
such as DBCS characters.  You should always use character codes rather than
scan codes.  This is important not only because of the above but also for
hardware independence (independence from keyboard types).

<P><HR>

<A HREF="069_L4_OnTheSpotConversioni.html">[Back: On-The-Spot Conversion in DBCS PM]</A> <BR>
<A HREF="071_L3_MnemonicsandAccelera.html">[Next: Mnemonics and Accelerator Key]</A> 
</BODY>
</HTML>
